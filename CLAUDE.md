# CLAUDE.md

> DivineSense é¡¹ç›®å¼€å‘çº²é¢† â€” Claude Code è¾…åŠ©å¼€å‘çš„æ ¸å¿ƒæŒ‡å¯¼æ–‡æ¡£
>
> **ä¿é²œçŠ¶æ€**: âœ… 2026-02-17 v0.99.1 | **æ¶æ„**: Go + React å•äºŒè¿›åˆ¶ | **AI**: Orchestrator-Workers å¤šä»£ç†

---

## ğŸ¯ é¡¹ç›®æœ¬è´¨

**DivineSense (ç¥è¯†)** = AI ä»£ç†é©±åŠ¨çš„ä¸ªäººã€Œç¬¬äºŒå¤§è„‘ã€

```
æŠ€æœ¯æ ˆï¼šGo åç«¯ + React å‰ç«¯ï¼ˆå•äºŒè¿›åˆ¶åˆ†å‘ï¼‰
æ ¸å¿ƒæ¶æ„ï¼šOrchestrator-Workers å¤šä»£ç† + Unified Block Model
```

---

## ğŸ”‘ Critical Contextï¼ˆå¿…è¯»ï¼‰

**è¯¦ç»†å†…å®¹**ï¼š`@docs/dev-guides/workflow/critical-context.md`

### ç›®å½•é€Ÿè§ˆ
| ç›®å½•      | è¯´æ˜                                    |
| :-------- | :-------------------------------------- |
| `web/`    | å‰ç«¯æ ¹ç›®å½• â€” **å§‹ç»ˆä»æ­¤å¤„è¿è¡Œå‰ç«¯å‘½ä»¤** |
| `ai/`     | AI æ ¸å¿ƒæ¨¡å—ï¼ˆGo ä¸€çº§æ¨¡å—ï¼‰              |
| `server/` | HTTP/gRPC æœåŠ¡å™¨                        |
| `store/`  | æ•°æ®è®¿é—®å±‚                              |
| `proto/`  | Protobuf å®šä¹‰ï¼ˆä¿®æ”¹åéœ€é‡æ–°ç”Ÿæˆï¼‰       |

### å…³é”®é…ç½®
| é…ç½®              | å€¼                                    |
| :---------------- | :------------------------------------ |
| GitHub ä»“åº“       | `hrygo/divinesense`                   |
| PostgreSQL å®¹å™¨å | `divinesense-postgres-dev`            |
| å‰ç«¯ç«¯å£          | 25173                                 |
| åç«¯ç«¯å£          | 28081                                 |
| æ•°æ®åº“ç«¯å£        | 25432                                 |

> **âš ï¸ æ³¨æ„**ï¼šæ‰§è¡Œ `gh` å‘½ä»¤æˆ– GitHub MCP å·¥å…·å‰ï¼Œå…ˆé€šè¿‡ `git remote -v | head -1` ç¡®è®¤ä»“åº“åç§°ã€‚å½“å‰ä»“åº“ï¼š`hrygo/divinesense`

### å¸¸è§é™·é˜±
| é™·é˜±                | è¯´æ˜                                           |
| :------------------ | :--------------------------------------------- |
| `max-w-md` ç­‰è¯­ä¹‰ç±» | Tailwind v4 è§£æä¸º ~16pxï¼Œç”¨ `max-w-[24rem]`   |
| i18n ä¸åŒæ­¥         | `make check-i18n` æ£€æŸ¥ en.json å’Œ zh-Hans.json |
| æœåŠ¡é‡å¯            | ä¿®æ”¹åç«¯ä»£ç åé€šçŸ¥ç”¨æˆ·æ‰‹åŠ¨ `make restart`      |
| SQLite æ—  AI        | ç”Ÿäº§ AI åŠŸèƒ½å¿…é¡»ç”¨ PostgreSQL                  |

---

## ğŸ§  Agent å·¥ä½œèŒƒå¼

**å·¥ä½œåè®®**ï¼š`@docs/dev-guides/agent/workflow.md`

### æ€è€ƒåè®®
```
ä»»åŠ¡ â†’ åˆ†æ â†’ æ–¹æ¡ˆ â†’ æ‰§è¡Œ â†’ éªŒè¯
         â†‘         â†“
         â””â”€â”€ ä¿®è®¢ â”€â”€â”˜
```

### å·¥å…·é€‰æ‹©
| ä»»åŠ¡           | å·¥å…·             |
| :------------- | :--------------- |
| ç†è§£ä»£ç åº“ç»“æ„ | `Task(Explore)`  |
| å®ç°æ–¹æ¡ˆè®¾è®¡   | `Task(Plan)`     |
| æŸ¥æ‰¾å…·ä½“æ–‡ä»¶   | `Glob`           |
| æœç´¢ä»£ç å†…å®¹   | `Grep`           |
| è¯»å–æ–‡ä»¶       | `Read`           |
| ç¼–è¾‘æ–‡ä»¶       | `Edit` / `Write` |

> **æ–‡ä»¶ç¼–è¾‘**ï¼šè¿ç»­ 3 æ¬¡ Edit å¤±è´¥æ—¶ï¼Œæ”¹ç”¨ `Read å®Œæ•´æ–‡ä»¶ â†’ Write æ•´ä½“é‡å†™`ã€‚è¯¦è§ @.claude/rules/file-editing.md

---

## ğŸ—ï¸ æ¶æ„é€Ÿè§ˆ

**æ¶æ„è¯¦æƒ…**ï¼š`@docs/architecture/summary.md`

### Orchestrator-Workers æ¶æ„
```
ç”¨æˆ·è¾“å…¥
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Orchestrator   â”‚ â† LLM é©±åŠ¨ä»»åŠ¡åˆ†è§£
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
    â†“    â†“    â†“    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚ Memo â”‚â”‚Sched â”‚â”‚Ideationâ”‚â”‚Generalâ”‚  â† Expert Agents (config/ é…ç½®åŒ–)
â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚       â”‚        â”‚        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Aggregator    â”‚ â† ç»“æœèšåˆï¼ˆå¦‚éœ€è¦ï¼‰
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸“å®¶ä»£ç† (Expert Agents)
| ä»£ç†                  | è§’è‰²     | å®ç°æ–¹å¼ |
| :-------------------- | :------- | :------- |
| MemoParrot (ç°ç°)     | ç¬”è®°æœç´¢ | UniversalParrot + memo.yaml |
| ScheduleParrot (æ—¶å·§) | æ—¥ç¨‹ç®¡ç† | UniversalParrot + schedule.yaml |
| IdeationParrot (çµå…‰) | åˆ›æ„ç”Ÿæˆ | UniversalParrot + ideation.yaml |
| GeneralParrot (é€šæ‰)  | é€šç”¨ä»»åŠ¡ | UniversalParrot + general.yaml |

> **æ¶æ„**: æ‰€æœ‰é¢†åŸŸä»£ç†åŸºäº **UniversalParrot** é…ç½®é©±åŠ¨å®ç°ï¼Œé€šè¿‡ YAML é…ç½®å®šä¹‰è¡Œä¸º

### å¤–éƒ¨æ‰§è¡Œå™¨ (External Executors)
| ä»£ç†                   | è§’è‰²            |
| :--------------------- | :-------------- |
| GeekParrot (æå®¢)      | Claude Code CLI |
| EvolutionParrot (è¿›åŒ–) | è‡ªæˆ‘è¿›åŒ–        |

> **æ³¨æ„**: AmazingParrot å·²è¢« Orchestrator æ›¿ä»£ï¼Œå…¶èŒè´£ç”± Orchestrator åŠ¨æ€åè°ƒ Expert Agents å®Œæˆã€‚

### è·¯ç”±ä¸ç¼–æ’ (ä¸¤å±‚: Cache â†’ Rule)
```
ç”¨æˆ·è¾“å…¥ â†’ ChatRouter
                â†“
         â”œâ”€> çŸ­ç¡®è®¤è¯? â†’ å¤ç”¨ä¸Šæ¬¡è·¯ç”± (session_sticky)
         â”œâ”€> FastRouter.ClassifyIntent()
         â”‚     â”œâ”€> L0: Cache (LRU)
         â”‚     â””â”€> L1: Rule Matcher (é…ç½®é©±åŠ¨)
         â”‚           â””â”€> confidence < 0.8 ? â†’ Orchestrator
         â””â”€> ç›´æ¥è·¯ç”±åˆ° UniversalParrot
```

> **ç®€åŒ–**: è·¯ç”±å±‚ LLM å·²ç§»é™¤ï¼Œæ”¹ä¸ºé…ç½®é©±åŠ¨è§„åˆ™åŒ¹é… + ç½®ä¿¡åº¦é˜ˆå€¼

### æ ¸å¿ƒæ¦‚å¿µ
- **Orchestrator**: LLM é©±åŠ¨çš„ä»»åŠ¡åˆ†è§£ä¸åè°ƒå™¨
- **UniversalParrot**: é…ç½®é©±åŠ¨çš„é€šç”¨ Agent å¼•æ“ï¼ˆæ›¿ä»£ç‹¬ç«‹ Parrot å®ç°ï¼‰
- **Expert Agent**: é¢†åŸŸä¸“å®¶ä»£ç†ï¼ˆåŸºäº UniversalParrot + YAML é…ç½®ï¼‰
- **Block**: ç”¨æˆ·-AI äº¤äº’è½®æ¬¡
- **Task Plan**: ç»“æ„åŒ–ä»»åŠ¡è®¡åˆ’ï¼Œæ”¯æŒé€æ˜æ€§å±•ç¤º
- **Context Engineering**: é•¿æœŸè®°å¿†æ£€ç´¢ï¼ˆepisodic memoryï¼‰ï¼ŒMemoParrot å·²å¯ç”¨
- **CCRunner**: ç»Ÿä¸€çš„ Claude Code æ‰§è¡Œå™¨ï¼ŒGeek/Evolution æ¨¡å¼å…±äº«
- **FastRouter**: ä¸¤å±‚è·¯ç”±ï¼ˆCache + Rule Matcherï¼‰ï¼Œé…ç½®é©±åŠ¨è§„åˆ™

---

## ğŸ”„ å·¥ä½œæµ

**å·¥ä½œè§„èŒƒ**ï¼š`@docs/dev-guides/workflow/general.md`

### å¼€å‘å‘½ä»¤
| é˜¶æ®µ   | å‘½ä»¤                          |
| :----- | :---------------------------- |
| å¯åŠ¨   | `make start`                  |
| å‰ç«¯   | `make web` / `make build-web` |
| æ•°æ®åº“ | `make db-shell`               |
| æ£€æŸ¥   | `make check-all`              |

### æäº¤æµç¨‹
```
make check-all â†’ feat/fix åˆ†æ”¯ â†’ PR â†’ åˆå¹¶
```
è¯¦ç»†è§„èŒƒï¼š`@.claude/rules/git-workflow.md`

### Git å·¥ä½œæµ
å¯¹äº PR å·¥ä½œæµï¼Œå§‹ç»ˆæŒ‰å®Œæ•´é¡ºåºæ‰§è¡Œï¼š
1. åˆ›å»º Issue
2. åˆ›å»ºåˆ†æ”¯
3. æäº¤ä»£ç 
4. æ¨é€åˆ†æ”¯
5. åˆ›å»º PR
6. åˆå¹¶åˆ†æ”¯
7. åˆ é™¤åˆ†æ”¯

**åˆå¹¶å**ï¼šæ£€æŸ¥åˆ†æ”¯æ˜¯å¦å¯ä»¥å®‰å…¨åˆ é™¤ï¼ˆä½¿ç”¨ `git fetch -p && git branch -vv` æŸ¥çœ‹å·²åˆå¹¶çš„è¿œç¨‹è¿½è¸ªåˆ†æ”¯ï¼‰ã€‚

---

## ğŸ“ ç¼–ç è§„èŒƒ

**ä»£ç é£æ ¼**ï¼š`@.claude/rules/code-style.md`

### æ ¸å¿ƒåŸåˆ™
> **å‡æ³• > åŠ æ³•**ï¼šåˆ é™¤é‡å¤ä»£ç ã€åˆå¹¶ç›¸ä¼¼åŠŸèƒ½

### è¯­è¨€è§„èŒƒ
| Go              | React/TS         | Tailwind v4        |
| :-------------- | :--------------- | :----------------- |
| `snake_case.go` | `PascalCase.tsx` | `max-w-[24rem]`    |
| `log/slog`      | `use` å‰ç¼€       | æ˜¾å¼å€¼é¿å…è§£æé”™è¯¯ |
| æ£€æŸ¥é”™è¯¯        | `t("key")`       |                    |

---

## âœ… æäº¤å‰éªŒè¯

åœ¨ä¿®å¤ bug æˆ–å¯¹ Go æ–‡ä»¶è¿›è¡Œä»£ç æ›´æ”¹åï¼Œ**æäº¤å‰**è¿è¡Œä»¥ä¸‹å‘½ä»¤å°½æ—©å‘ç°ç¼–è¯‘é”™è¯¯å’Œæµ‹è¯•å¤±è´¥ï¼š

```bash
go build ./... && go test ./...
```

---

## ğŸ”§ å®æ–½æ ‡å‡†

å®æ–½è·¨å¤šä¸ªæ–‡ä»¶çš„åŠŸèƒ½æ—¶ï¼ˆä¾‹å¦‚è·¯ç”±å˜æ›´ã€API + å‰ç«¯æ›´æ–°ï¼‰ï¼ŒéªŒè¯æ‰€æœ‰å—å½±å“çš„å±‚æ˜¯ä¸€è‡´çš„ï¼š
- åç«¯ API è¿”å›æ­£ç¡®çš„æ•°æ®
- å‰ç«¯æ­£ç¡®ä½¿ç”¨åç«¯æ•°æ®
- æ²¡æœ‰æœªä½¿ç”¨çš„ä»£ç 

---

## ğŸ“š æ–‡æ¡£å¯¼èˆª

| ä»»åŠ¡              | æ–‡æ¡£                                               |
| :---------------- | :------------------------------------------------- |
| ç†è§£æ¶æ„          | `@docs/architecture/overview.md`                   |
| Orchestrator è®¾è®¡ | `@docs/research/orchestrator-workers-research.md`  |
| åç«¯å¼€å‘          | `@docs/dev-guides/backend/database.md`             |
| å‰ç«¯å¼€å‘          | `@docs/dev-guides/frontend/overview.md`            |
| éƒ¨ç½²              | `@docs/dev-guides/deployment/BINARY_DEPLOYMENT.md` |
| è°ƒè¯•é—®é¢˜          | `@docs/research/DEBUG_LESSONS.md`                  |
| æ•°æ®åº“è¿ç§»        | `@store/migration/postgres/CLAUDE.md`              |

---

*æœ¬æ–‡æ¡£éšé¡¹ç›®æ¼”è¿›è‡ªåŠ¨æ›´æ–°ã€‚*
