# ==============================================================================
# DivineSense 环境变量配置
# ==============================================================================
# 使用: cp .env.example .env && 编辑填入配置

# ==============================================================================
# 一、快速开始 (最小配置)
# ==============================================================================

# 数据库 (AI 功能需要 PostgreSQL + pgvector)
DIVINESENSE_DRIVER=postgres
DIVINESENSE_DSN=postgres://divinesense:divinesense@localhost:25432/divinesense?sslmode=disable

# AI 功能开关
DIVINESENSE_AI_ENABLED=true

# ────────────────────────────────────────────────────────────────────────────────
# 推荐配置: SiliconFlow + 智谱 Z.AI Claude
# ────────────────────────────────────────────────────────────────────────────────
# 获取 API Keys:
#   - SiliconFlow: https://cloud.siliconflow.cn/account/ak
#   - 智谱 Z.AI:   https://open.bigmodel.cn/usercenter/apikeys
# ────────────────────────────────────────────────────────────────────────────────

# LLM 对话 (智谱 Z.AI 提供的 Claude，支持简化别名)
DIVINESENSE_AI_LLM_PROVIDER=anthropic
DIVINESENSE_AI_LLM_MODEL=opus
DIVINESENSE_AI_ANTHROPIC_API_KEY=sk-ant-your-key
DIVINESENSE_AI_ANTHROPIC_BASE_URL=https://open.bigmodel.cn/api/anthropic

# 向量 + 重排 (SiliconFlow)
DIVINESENSE_AI_EMBEDDING_PROVIDER=siliconflow
DIVINESENSE_AI_EMBEDDING_MODEL=BAAI/bge-m3
DIVINESENSE_AI_RERANK_MODEL=BAAI/bge-reranker-v2-m3
DIVINESENSE_AI_SILICONFLOW_API_KEY=sk-your-siliconflow-key

# ==============================================================================
# 二、AI 配置方案速查
# ==============================================================================

# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ 方案 A: SiliconFlow + Z.AI Claude [★ 默认推荐]                              │
# │ ─────────────────────────────────────────────────────────────────────────── │
# │ 最佳组合：SiliconFlow 提供向量和重排，智谱 Z.AI 提供 Claude 服务             │
# │                                                                             │
# │ LLM:    Claude Opus 4.6 / Sonnet 5 (智谱 Z.AI 提供，国内稳定)              │
# │ Embed:  SiliconFlow BAAI/bge-m3                                             │
# │ Rerank: SiliconFlow BAAI/bge-reranker-v2-m3                                 │
# │                                                                             │
# │ 配置:                                                                       │
# │   DIVINESENSE_AI_LLM_PROVIDER=anthropic                                    │
# │   DIVINESENSE_AI_ANTHROPIC_API_KEY=sk-ant-xxx                              │
# │   DIVINESENSE_AI_LLM_MODEL=claude-opus-7-20250219                           │
# │   DIVINESENSE_AI_ANTHROPIC_BASE_URL=https://open.bigmodel.cn/api/anthropic  │
# │   DIVINESENSE_AI_EMBEDDING_PROVIDER=siliconflow                             │
# │   DIVINESENSE_AI_SILICONFLOW_API_KEY=sk-xxx                                │
# └─────────────────────────────────────────────────────────────────────────────┘

# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ 方案 B: SiliconFlow + DeepSeek                                             │
# │ ─────────────────────────────────────────────────────────────────────────── │
# │ 成本最优，国内访问稳定                                                      │
# │                                                                             │
# │ LLM:    DeepSeek V3.2                                                      │
# │ Embed:  SiliconFlow BAAI/bge-m3                                             │
# │ Rerank: SiliconFlow BAAI/bge-reranker-v2-m3                                 │
# │                                                                             │
# │ 配置:                                                                       │
# │   DIVINESENSE_AI_LLM_PROVIDER=deepseek                                     │
# │   DIVINESENSE_AI_DEEPSEEK_API_KEY=sk-xxx                                   │
# │   DIVINESENSE_AI_EMBEDDING_PROVIDER=siliconflow                             │
# │   DIVINESENSE_AI_SILICONFLOW_API_KEY=sk-xxx                                │
# └─────────────────────────────────────────────────────────────────────────────┘

# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ 方案 C: 纯 SiliconFlow                                                    │
# │ ─────────────────────────────────────────────────────────────────────────── │
# │ 单一供应商，管理简单                                                        │
# │                                                                             │
# │ LLM:    Qwen/Qwen2.5-72B-Instruct                                          │
# │ Embed:  BAAI/bge-m3                                                        │
# │ Rerank: BAAI/bge-reranker-v2-m3                                            │
# │                                                                             │
# │ 配置:                                                                       │
# │   DIVINESENSE_AI_LLM_PROVIDER=siliconflow                                  │
# │   DIVINESENSE_AI_LLM_MODEL=Qwen/Qwen2.5-72B-Instruct                       │
# │   DIVINESENSE_AI_SILICONFLOW_API_KEY=sk-xxx                                │
# └─────────────────────────────────────────────────────────────────────────────┘

# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ 方案 D: OpenAI 全家桶                                                      │
# │ ─────────────────────────────────────────────────────────────────────────── │
# │ 海外用户，追求效果                                                          │
# │                                                                             │
# │ LLM:    gpt-4o                                                             │
# │ Embed:  text-embedding-3-small                                             │
# │ Rerank: (使用 SiliconFlow)                                                  │
# │                                                                             │
# │ 配置:                                                                       │
# │   DIVINESENSE_AI_LLM_PROVIDER=openai                                       │
# │   DIVINESENSE_AI_OPENAI_API_KEY=sk-xxx                                     │
# │   DIVINESENSE_AI_LLM_MODEL=gpt-4o                                          │
# │   DIVINESENSE_AI_EMBEDDING_PROVIDER=openai                                 │
# │   DIVINESENSE_AI_EMBEDDING_MODEL=text-embedding-3-small                    │
# └─────────────────────────────────────────────────────────────────────────────┘

# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ 方案 E: 本地 Ollama                                                       │
# │ ─────────────────────────────────────────────────────────────────────────── │
# │ 完全离线，数据私密                                                          │
# │                                                                             │
# │ LLM:    llama3.1                                                           │
# │ Embed:  nomic-embed-text                                                   │
# │ Rerank: (不支持)                                                            │
# │                                                                             │
# │ 配置:                                                                       │
# │   DIVINESENSE_AI_LLM_PROVIDER=ollama                                       │
# │   DIVINESENSE_AI_OLLAMA_BASE_URL=http://localhost:11434                    │
# │   DIVINESENSE_AI_LLM_MODEL=llama3.1                                        │
# │   DIVINESENSE_AI_EMBEDDING_PROVIDER=ollama                                 │
# │   DIVINESENSE_AI_EMBEDDING_MODEL=nomic-embed-text                           │
# └─────────────────────────────────────────────────────────────────────────────┘

# ==============================================================================
# 三、AI Provider 配置详解
# ==============================================================================

# ────────────────────────────────────────────────────────────────────────────────
# Provider 选择 (可选值)
# ────────────────────────────────────────────────────────────────────────────────
# 对话 LLM:    anthropic | deepseek | siliconflow | openai | ollama
# 向量 Embed:  siliconflow | openai | ollama
# 意图 Intent: (固定使用 siliconflow)
# 重排 Rerank: (固定使用 siliconflow)
# ────────────────────────────────────────────────────────────────────────────────

# 对话 Provider
# DIVINESENSE_AI_LLM_PROVIDER=anthropic

# 向量 Provider
# DIVINESENSE_AI_EMBEDDING_PROVIDER=siliconflow

# ────────────────────────────────────────────────────────────────────────────────
# Anthropic Claude (智谱 Z.AI 提供)
# ────────────────────────────────────────────────────────────────────────────────
# 获取 API Key: https://open.bigmodel.cn/usercenter/apikeys
#
# 支持的模型:
#   简化别名 (智谱 Z.AI 支持):
#   • opus   → claude-opus-7-20250219  (Claude Opus 4.6，最高能力)
#   • sonnet → claude-sonnet-7-20250219 (Claude Sonnet 5，最新，推荐)
#   • haiku  → claude-3-5-haiku-20241022  (快速响应，低成本)
#
#   完整模型名:
#   • claude-opus-7-20250219
#   • claude-sonnet-7-20250219
#   • claude-3-5-sonnet-20241022 (稳定版本)
#   • claude-3-5-haiku-20241022
#
# BASE_URL 说明:
#   • https://open.bigmodel.cn/api/anthropic (智谱 Z.AI 提供，推荐)
#   • https://api.anthropic.com (官方 API，不设置则使用此值)
# ────────────────────────────────────────────────────────────────────────────────
# DIVINESENSE_AI_ANTHROPIC_API_KEY=sk-ant-your-key
# DIVINESENSE_AI_ANTHROPIC_BASE_URL=https://open.bigmodel.cn/api/anthropic

# ────────────────────────────────────────────────────────────────────────────────
# DeepSeek
# ────────────────────────────────────────────────────────────────────────────────
# 获取 API Key: https://platform.deepseek.com/api_keys
#
# 支持的模型: deepseek-chat (V3.2)
# ────────────────────────────────────────────────────────────────────────────────
# DIVINESENSE_AI_DEEPSEEK_API_KEY=sk-your-deepseek-key
# DIVINESENSE_AI_DEEPSEEK_BASE_URL=https://api.deepseek.com

# ────────────────────────────────────────────────────────────────────────────────
# SiliconFlow
# ────────────────────────────────────────────────────────────────────────────────
# 获取 API Key: https://cloud.siliconflow.cn/account/ak
#
# 用途: 向量 Embed + 重排 Rerank + 意图 Intent
#       也可用作 LLM (Qwen 系列)
# ────────────────────────────────────────────────────────────────────────────────
# DIVINESENSE_AI_SILICONFLOW_API_KEY=sk-your-siliconflow-key
# DIVINESENSE_AI_SILICONFLOW_BASE_URL=https://api.siliconflow.cn/v1

# ────────────────────────────────────────────────────────────────────────────────
# OpenAI
# ────────────────────────────────────────────────────────────────────────────────
# 获取 API Key: https://platform.openai.com/api-keys
# ────────────────────────────────────────────────────────────────────────────────
# DIVINESENSE_AI_OPENAI_API_KEY=sk-your-openai-key
# DIVINESENSE_AI_OPENAI_BASE_URL=https://api.openai.com/v1

# ────────────────────────────────────────────────────────────────────────────────
# Ollama (本地部署)
# ────────────────────────────────────────────────────────────────────────────────
# 安装: https://ollama.com
# 模型列表: https://ollama.com/search
# ────────────────────────────────────────────────────────────────────────────────
# DIVINESENSE_AI_OLLAMA_BASE_URL=http://localhost:11434

# ==============================================================================
# 四、AI 高级配置 (缓存优化)
# ==============================================================================

# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ 三层缓存架构                                                                │
# │ ─────────────────────────────────────────────────────────────────────────── │
# │ L1: 路由缓存 (意图分类结果)  → TTL: 规则 5min, LLM 30min, 容量: 500      │
# │ L2: 语义缓存 (Embedding 向量) → 相似度: 0.95, 容量: 1000, TTL: 24h      │
# │ L3: 工具缓存 (数据库查询)    → 容量: 100, TTL 按工具配置                  │
# │                                                                             │
# │ 成本节省: ~$1.0/日 (假设 1000 次/日查询)                                   │
# └─────────────────────────────────────────────────────────────────────────────┘

# 语义缓存
# DIVINESENSE_SEMANTIC_CACHE_MAX_ENTRIES=1000
# DIVINESENSE_SEMANTIC_CACHE_SIMILARITY_THRESHOLD=0.95
# DIVINESENSE_SEMANTIC_CACHE_TTL=24h

# 工具结果缓存
# DIVINESENSE_TOOL_CACHE_ENABLED=true
# DIVINESENSE_TOOL_CACHE_MAX_ENTRIES=100
# DIVINESENSE_TOOL_CACHE_TTL_SCHEDULE_QUERY=30s
# DIVINESENSE_TOOL_CACHE_TTL_MEMO_SEARCH=5m

# Token 预算分配 (按 AgentType 自动选择)
# DIVINESENSE_BUDGET_MEMO_SEARCH_RETRIEVAL=0.70
# DIVINESENSE_BUDGET_AMAZING_RETRIEVAL=0.50

# ==============================================================================
# 五、Geek Mode (Claude Code CLI 集成)
# ==============================================================================

# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ Geek Mode 允许用户在聊天中调用 Claude Code CLI 处理通用任务                  │
# │                                                                             │
# │ 核心能力: 代码开发 • 系统运维 • 文件管理 • 数据维护 • 自动化               │
# │                                                                             │
# │ 前置条件:                                                                   │
# │   1. npm install -g @anthropic-ai/claude-code                               │
# │   2. npx @z_ai/coding-helper  (智谱适配，推荐)                              │
# │   3. claude --version  (验证安装)                                           │
# └─────────────────────────────────────────────────────────────────────────────┘

# 启用 Geek Mode
DIVINESENSE_CLAUDE_CODE_ENABLED=false

# 工作目录 (可选，默认: ~/.divinesense/claude)
# DIVINESENSE_CLAUDE_CODE_WORKDIR=/opt/divinesense/data

# 启用 Evolution Mode (进化模式 - 可修改项目源码)
DIVINESENSE_EVOLUTION_ENABLED=false

# Evolution Mode 仅限管理员
# DIVINESENSE_EVOLUTION_ADMIN_ONLY=true

# ==============================================================================
# 六、聊天应用集成 (Telegram / 钉钉 / WhatsApp)
# ==============================================================================

# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ 用于加密存储聊天平台的访问令牌 (AES-256-GCM)                                │
# │                                                                             │
# │ ⚠️ 重要: 密钥长度必须严格为 32 字节                                         │
# │                                                                             │
# │ 生成密钥: openssl rand -base64 32 | cut -c1-32                             │
# └─────────────────────────────────────────────────────────────────────────────┘

# 加密密钥 (必需)
# DIVINESENSE_CHAT_APPS_SECRET_KEY=change_me_to_a_random_32_byte_string

# 实例 URL (用于生成 Webhook)
DIVINESENSE_INSTANCE_URL=http://localhost:28081

# WhatsApp 桥接服务地址 (可选)
# DIVINESENSE_WHATSAPP_BRIDGE_URL=http://localhost:3001

# ==============================================================================
# 七、附件处理
# ==============================================================================

# OCR 图片文字提取 (需安装 Tesseract)
# DIVINESENSE_OCR_ENABLED=true
# DIVINESENSE_OCR_LANGUAGES=chi_sim+eng

# 文档文本提取 (需部署 Apache Tika)
# DIVINESENSE_TEXTEXTRACT_ENABLED=true
# DIVINESENSE_TEXTEXTRACT_TIKA_URL=http://localhost:9998

# ==============================================================================
# 八、二进制部署配置
# ==============================================================================

# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ 二进制部署安装位置:                                                          │
# │   - 二进制文件: /opt/divinesense/bin/divinesense                             │
# │   - 数据目录:   /opt/divinesense/data                                        │
# │   - 配置文件:   /etc/divinesense/config                                      │
# │   - 日志目录:   /opt/divinesense/logs                                        │
# │                                                                             │
# │ 快速安装:                                                                   │
# │   curl -fsSL https://raw.githubusercontent.com/hrygo/divinesense/main/       │
# │           deploy/aliyun/install.sh | sudo bash -s -- --mode=binary          │
# │                                                                             │
# │ 详细文档: docs/deployment/BINARY_DEPLOYMENT.md                               │
# └─────────────────────────────────────────────────────────────────────────────┘

# 生产环境数据库配置示例
# DIVINESENSE_DSN=postgres://divinesense:<your-password>@localhost:5432/divinesense?sslmode=disable
