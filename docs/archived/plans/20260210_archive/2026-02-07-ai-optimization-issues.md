# AI æ™ºèƒ½åŠ©ç†ä¼˜åŒ–å»ºè®® - GitHub Issues è§„åˆ’

> **åˆ›å»ºæ—¥æœŸ**: 2026-02-07  
> **æ¥æº**: NORMAL_MODE_ASSISTANT_ANALYSIS.md æ·±åº¦åˆ†ææŠ¥å‘Š  
> **çŠ¶æ€**: âœ… å·²åˆ›å»ºæ‰€æœ‰ Issues

---

## âœ… å·²åˆ›å»ºçš„ GitHub Issues

| Issue #                                                 | æ ‡é¢˜                 | ä¼˜å…ˆçº§ | çŠ¶æ€       |
| ------------------------------------------------------- | -------------------- | ------ | ---------- |
| [#91](https://github.com/hrygo/divinesense/issues/91)   | è¯­ä¹‰ç¼“å­˜å±‚å®ç°       | P1     | ğŸ”´ Open     |
| [#92](https://github.com/hrygo/divinesense/issues/92)   | å·¥å…·çº§æ£€ç´¢ç»“æœç¼“å­˜   | P1     | ğŸ”´ Open     |
| [#93](https://github.com/hrygo/divinesense/issues/93)   | åŠ¨æ€ Token é¢„ç®—åˆ†é…  | P1     | ğŸ”´ Open     |
| [#94](https://github.com/hrygo/divinesense/issues/94)   | å¢é‡ä¸Šä¸‹æ–‡æ›´æ–°       | P2     | ğŸ”´ Open     |
| [#95](https://github.com/hrygo/divinesense/issues/95)   | è§„åˆ™è·¯ç”±æƒé‡åŠ¨æ€è°ƒæ•´ | P2     | ğŸ”´ Open     |
| [#96](https://github.com/hrygo/divinesense/issues/96)   | è½»é‡ ML æ„å›¾åˆ†ç±»å™¨   | P2     | ğŸ”´ Open     |
| [#97](https://github.hrygo/divinesense/issues/97)       | æ¸è¿›å¼è¿›åº¦åé¦ˆ       | P2     | ğŸ”´ Open     |
| [#98](https://github.com/hrygo/divinesense/issues/98)   | æ™ºèƒ½å¿«æ·å›å¤ç”Ÿæˆ     | P2     | ğŸ”´ Open     |
| [#99](https://github.com/hrygo/divinesense/issues/99)   | ç«¯åˆ°ç«¯è¿½è¸ªç³»ç»Ÿ       | P2     | ğŸ”´ Open     |
| [#100](https://github.com/hrygo/divinesense/issues/100) | Prometheus æŒ‡æ ‡å¢å¼º  | P3     | ğŸ”´ Open     |
| [#101](https://github.com/hrygo/divinesense/issues/101) | æ•æ„Ÿä¿¡æ¯è¿‡æ»¤å™¨       | P3     | ğŸ”´ Open     |
| [#102](https://github.com/hrygo/divinesense/issues/102) | é¢„æµ‹æ€§é¢„åŠ è½½         | P3     | ğŸ”´ Open     |
| [#103](https://github.com/hrygo/divinesense/issues/103) | **ä¼˜åŒ–è®¡åˆ’æ€»è§ˆ**     | -      | ğŸ“‹ Tracking |

---

## Issue åˆ†ç»„ç­–ç•¥

å°†ä¼˜åŒ–å»ºè®®æ‹†åˆ†ä¸º **12 ä¸ªåŸå­åŒ– Issues**ï¼ŒæŒ‰ä¼˜å…ˆçº§å’Œå¤æ‚åº¦æ’åºï¼š

| ID  | Issue æ ‡é¢˜           | ä¼˜å…ˆçº§ | å¤æ‚åº¦ | æ ‡ç­¾                   |
| --- | -------------------- | ------ | ------ | ---------------------- |
| 1   | è¯­ä¹‰ç¼“å­˜å±‚å®ç°       | P1     | é«˜     | ai, æ€§èƒ½ä¼˜åŒ–, backend  |
| 2   | æ£€ç´¢ç»“æœç¼“å­˜         | P1     | ä¸­     | ai, æ€§èƒ½ä¼˜åŒ–, backend  |
| 3   | åŠ¨æ€ Token é¢„ç®—åˆ†é…  | P1     | ä¸­     | ai, æ€§èƒ½ä¼˜åŒ–, backend  |
| 4   | å¢é‡ä¸Šä¸‹æ–‡æ›´æ–°       | P2     | é«˜     | ai, æ€§èƒ½ä¼˜åŒ–, backend  |
| 5   | è§„åˆ™è·¯ç”±æƒé‡åŠ¨æ€è°ƒæ•´ | P2     | ä¸­     | ai, backend            |
| 6   | è½»é‡ ML æ„å›¾åˆ†ç±»å™¨   | P2     | é«˜     | ai, backend, research  |
| 7   | æ¸è¿›å¼è¿›åº¦åé¦ˆ       | P2     | ä¸­     | ai, frontend, ux       |
| 8   | æ™ºèƒ½å¿«æ·å›å¤ç”Ÿæˆ     | P2     | ä¸­     | ai, frontend, ux       |
| 9   | ç«¯åˆ°ç«¯è¿½è¸ªç³»ç»Ÿ       | P2     | ä¸­     | ai, backend            |
| 10  | Prometheus æŒ‡æ ‡å¢å¼º  | P3     | ä½     | ai, backend            |
| 11  | æ•æ„Ÿä¿¡æ¯è¿‡æ»¤å™¨       | P3     | ä½     | ai, backend            |
| 12  | é¢„æµ‹æ€§é¢„åŠ è½½         | P3     | é«˜     | ai, æ€§èƒ½ä¼˜åŒ–, research |

---

## Issue è¯¦ç»†è§„åˆ’

### Issue 1: è¯­ä¹‰ç¼“å­˜å±‚å®ç°

**ä¼˜å…ˆçº§**: P1 (é«˜)  
**å¤æ‚åº¦**: é«˜  
**é¢„ä¼°å·¥æ—¶**: 3-5 å¤©

#### é—®é¢˜æè¿°
å½“å‰ AmazingParrot ä½¿ç”¨ç®€å•çš„ LRU ç¼“å­˜ï¼ŒåŸºäºå®Œæ•´è¾“å…¥çš„ hash è¿›è¡Œç²¾ç¡®åŒ¹é…ã€‚è¿™å¯¼è‡´ï¼š
- è¯­ä¹‰ç›¸ä¼¼ä½†æªè¾ä¸åŒçš„æŸ¥è¯¢æ— æ³•å‘½ä¸­ç¼“å­˜
- ç¼“å­˜å‘½ä¸­ç‡é¢„ä¼°ä»… ~30%

#### å»ºè®®æ–¹æ¡ˆ
å®ç°åŸºäº embedding ç›¸ä¼¼åº¦çš„è¯­ä¹‰ç¼“å­˜å±‚ï¼š

```go
type SemanticCache struct {
    vectors    []float32          // å·²ç¼“å­˜æŸ¥è¯¢çš„å‘é‡
    responses  []string           // å¯¹åº”çš„å“åº”
    threshold  float32            // ç›¸ä¼¼åº¦é˜ˆå€¼ (0.95)
    maxSize    int                // æœ€å¤§ç¼“å­˜æ¡ç›®
    embedding  embedding.Service  // å‘é‡åŒ–æœåŠ¡
}

func (c *SemanticCache) Get(query string) (string, bool) {
    vec := c.embedding.Encode(query)
    for i, cached := range c.vectors {
        if cosineSimilarity(vec, cached) >= c.threshold {
            return c.responses[i], true
        }
    }
    return "", false
}
```

#### æ–‡ä»¶å˜æ›´
- `ai/agent/cache.go` - æ–°å¢ SemanticCache å®ç°
- `ai/agent/amazing_parrot.go` - é›†æˆå¤šçº§ç¼“å­˜

#### éªŒæ”¶æ ‡å‡†
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ >80%
- [ ] åŸºå‡†æµ‹è¯•æ˜¾ç¤ºå‘½ä¸­ç‡æå‡ >20%
- [ ] ä¸å¢åŠ  P95 å»¶è¿Ÿè¶…è¿‡ 50ms

---

### Issue 2: æ£€ç´¢ç»“æœç¼“å­˜

**ä¼˜å…ˆçº§**: P1 (é«˜)  
**å¤æ‚åº¦**: ä¸­  
**é¢„ä¼°å·¥æ—¶**: 1-2 å¤©

#### é—®é¢˜æè¿°
æ—¥ç¨‹æŸ¥è¯¢å’Œç¬”è®°æœç´¢ç»“æœæ²¡æœ‰ç¼“å­˜ï¼Œç›¸åŒæ—¶é—´èŒƒå›´çš„é‡å¤æŸ¥è¯¢æ¯æ¬¡éƒ½ä¼šè®¿é—®æ•°æ®åº“ã€‚

#### å»ºè®®æ–¹æ¡ˆ
æ·»åŠ å·¥å…·çº§åˆ«çš„ç»“æœç¼“å­˜ï¼š

```go
type ToolResultCache struct {
    cache    *lru.Cache
    ttl      time.Duration
}

type CacheKey struct {
    ToolName   string
    UserID     int32
    InputHash  string
}

// é’ˆå¯¹ä¸åŒå·¥å…·çš„ TTL ç­–ç•¥
var toolTTLs = map[string]time.Duration{
    "schedule_query": 30 * time.Second,  // æ—¥ç¨‹å˜åŒ–è¾ƒå°‘
    "memo_search":    5 * time.Minute,   // ç¬”è®°æœç´¢ç»“æœç¨³å®š
    "find_free_time": 1 * time.Minute,   // ç©ºé—²æ—¶é—´éœ€è¦è¾ƒæ–°
}
```

#### æ–‡ä»¶å˜æ›´
- `ai/agent/tools/cache.go` - æ–°å¢å·¥å…·ç»“æœç¼“å­˜
- `ai/agent/tools/scheduler.go` - é›†æˆç¼“å­˜
- `ai/agent/tools/memo_search.go` - é›†æˆç¼“å­˜

#### éªŒæ”¶æ ‡å‡†
- [ ] é…ç½®åŒ–çš„ TTL ç­–ç•¥
- [ ] ç¼“å­˜å¤±æ•ˆæœºåˆ¶ (æ—¥ç¨‹å˜æ›´æ—¶å¤±æ•ˆ)
- [ ] æ—¥å¿—è®°å½•å‘½ä¸­/æœªå‘½ä¸­

---

### Issue 3: åŠ¨æ€ Token é¢„ç®—åˆ†é…

**ä¼˜å…ˆçº§**: P1 (é«˜)  
**å¤æ‚åº¦**: ä¸­  
**é¢„ä¼°å·¥æ—¶**: 2-3 å¤©

#### é—®é¢˜æè¿°
å½“å‰ `BudgetAllocator` ä½¿ç”¨å›ºå®šæ¯”ä¾‹åˆ†é… Token é¢„ç®—ï¼Œä¸è€ƒè™‘ä»»åŠ¡ç±»å‹ï¼š
- æŸ¥è¯¢ç±»åº”ç»™æ£€ç´¢æ›´å¤šç©ºé—´
- åˆ›å»ºç±»åº”ç»™å†å²ä¸Šä¸‹æ–‡æ›´å¤šç©ºé—´
- é—²èŠç±»å‡ ä¹ä¸éœ€è¦æ£€ç´¢ç©ºé—´

#### å»ºè®®æ–¹æ¡ˆ

```go
type AdaptiveBudgetAllocator struct {
    profiles map[Intent]*BudgetProfile
}

type BudgetProfile struct {
    ShortTermRatio float64
    LongTermRatio  float64
    RetrievalRatio float64
    UserPrefsRatio float64
}

var defaultProfiles = map[Intent]*BudgetProfile{
    IntentQuery:  {0.25, 0.10, 0.55, 0.10},
    IntentCreate: {0.50, 0.20, 0.20, 0.10},
    IntentChat:   {0.60, 0.25, 0.05, 0.10},
    IntentUpdate: {0.45, 0.15, 0.30, 0.10},
}
```

#### æ–‡ä»¶å˜æ›´
- `ai/context/budget.go` - é‡æ„ä¸ºè‡ªé€‚åº”åˆ†é…
- `ai/context/builder_impl.go` - ä¼ é€’ Intent ä¿¡æ¯

#### éªŒæ”¶æ ‡å‡†
- [ ] æ”¯æŒæŒ‰ Intent åŠ¨æ€åˆ†é…
- [ ] é…ç½®åŒ–çš„ Profile å®šä¹‰
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–å„ç§åœºæ™¯

---

### Issue 4: å¢é‡ä¸Šä¸‹æ–‡æ›´æ–°

**ä¼˜å…ˆçº§**: P2 (ä¸­)  
**å¤æ‚åº¦**: é«˜  
**é¢„ä¼°å·¥æ—¶**: 3-5 å¤©

#### é—®é¢˜æè¿°
æ¯æ¬¡å¯¹è¯éƒ½å®Œæ•´é‡å»ºä¸Šä¸‹æ–‡ï¼ŒåŒ…æ‹¬ï¼š
- é‡æ–°è®¡ç®—æ‰€æœ‰ Token ä¼°ç®—
- é‡æ–°æ’åºæ‰€æœ‰ä¸Šä¸‹æ–‡ç‰‡æ®µ
- é‡æ–°æˆªæ–­åˆ°é¢„ç®—

å¤šè½®å¯¹è¯ä¸­ï¼Œåªæœ‰æœ€æ–°æ¶ˆæ¯å˜åŒ–ï¼Œå…¶ä½™å¯å¤ç”¨ã€‚

#### å»ºè®®æ–¹æ¡ˆ

```go
type IncrementalContextBuilder struct {
    lastResult   *ContextResult
    lastChecksum string
    dirty        map[string]bool  // æ ‡è®°å“ªäº›éƒ¨åˆ†éœ€è¦æ›´æ–°
}

func (b *IncrementalContextBuilder) Build(req *ContextRequest) (*ContextResult, error) {
    delta := b.computeDelta(req)
    
    switch {
    case delta.OnlyNewMessage:
        return b.appendOnly(req)
    case delta.RetrievalUnchanged:
        return b.updateConversationOnly(req)
    default:
        return b.fullRebuild(req)
    }
}
```

#### æ–‡ä»¶å˜æ›´
- `ai/context/incremental_builder.go` - æ–°å¢å¢é‡æ„å»ºå™¨
- `ai/context/builder_impl.go` - æ·»åŠ å¢é‡æ¨¡å¼æ”¯æŒ

#### éªŒæ”¶æ ‡å‡†
- [ ] å¤šè½®å¯¹è¯åœºæ™¯æ€§èƒ½æå‡ >30%
- [ ] ç»“æœä¸å®Œæ•´æ„å»ºä¸€è‡´
- [ ] å†…å­˜ä½¿ç”¨ä¸æ˜¾è‘—å¢åŠ 

---

### Issue 5: è§„åˆ™è·¯ç”±æƒé‡åŠ¨æ€è°ƒæ•´

**ä¼˜å…ˆçº§**: P2 (ä¸­)  
**å¤æ‚åº¦**: ä¸­  
**é¢„ä¼°å·¥æ—¶**: 2-3 å¤©

#### é—®é¢˜æè¿°
å½“å‰è§„åˆ™è·¯ç”±å™¨ä½¿ç”¨é™æ€ä¼˜å…ˆçº§ï¼Œè§„åˆ™æ•ˆæœæ— æ³•é‡åŒ–ï¼Œä¹Ÿæ— æ³•æ ¹æ®å®é™…ä½¿ç”¨è°ƒæ•´ã€‚

#### å»ºè®®æ–¹æ¡ˆ

```go
type AdaptiveRuleMatcher struct {
    rules       []RoutingRule
    hitCounters map[int]int64      // è§„åˆ™å‘½ä¸­è®¡æ•°
    successRate map[int]float64    // è§„åˆ™æˆåŠŸç‡
}

func (m *AdaptiveRuleMatcher) RecordFeedback(ruleID int, wasCorrect bool) {
    m.hitCounters[ruleID]++
    if wasCorrect {
        // æé«˜è§„åˆ™æƒé‡
        m.adjustWeight(ruleID, +0.01)
    } else {
        // é™ä½è§„åˆ™æƒé‡
        m.adjustWeight(ruleID, -0.05)
    }
}
```

#### æ–‡ä»¶å˜æ›´
- `ai/router/rules.go` - æ·»åŠ åŠ¨æ€æƒé‡
- `ai/router/service.go` - é›†æˆåé¦ˆæœºåˆ¶

#### éªŒæ”¶æ ‡å‡†
- [ ] æƒé‡æŒä¹…åŒ–å­˜å‚¨
- [ ] æä¾›è§„åˆ™æ•ˆæœä»ªè¡¨æ¿æ•°æ®
- [ ] æ”¯æŒæ‰‹åŠ¨é‡ç½®æƒé‡

---

### Issue 6: è½»é‡ ML æ„å›¾åˆ†ç±»å™¨

**ä¼˜å…ˆçº§**: P2 (ä¸­)  
**å¤æ‚åº¦**: é«˜  
**é¢„ä¼°å·¥æ—¶**: 5-7 å¤©

#### é—®é¢˜æè¿°
å½“è§„åˆ™åŒ¹é…å¤±è´¥æ—¶ï¼Œéœ€è¦è°ƒç”¨ LLM è¿›è¡Œæ„å›¾åˆ†ç±»ï¼Œå¢åŠ å»¶è¿Ÿ (~100ms) å’Œæˆæœ¬ã€‚

#### å»ºè®®æ–¹æ¡ˆ
è®­ç»ƒè½»é‡çº§ ML æ¨¡å‹æ›¿ä»£éƒ¨åˆ† LLM è°ƒç”¨ï¼š

```go
type TinyClassifier struct {
    model     *onnx.Model  // ONNX æ ¼å¼çš„å°æ¨¡å‹
    tokenizer *Tokenizer
    threshold float32
}

func (c *TinyClassifier) Predict(input string) (AgentType, float32) {
    tokens := c.tokenizer.Encode(input)
    output := c.model.Run(tokens)
    
    // è·å–æœ€é«˜ç½®ä¿¡åº¦çš„ç±»åˆ«
    maxIdx, maxConf := argmax(output)
    return AgentType(maxIdx), maxConf
}
```

#### æŠ€æœ¯é€‰å‹
- æ¨¡å‹: DistilBERT-tiny æˆ–è‡ªå®šä¹‰ TextCNN
- æ ¼å¼: ONNX (è·¨å¹³å°æ¨ç†)
- è®­ç»ƒæ•°æ®: ä»å†å²æ—¥å¿—æå–

#### æ–‡ä»¶å˜æ›´
- `ai/router/classifier.go` - æ–°å¢ ML åˆ†ç±»å™¨
- `ai/router/service.go` - é›†æˆåˆ°è·¯ç”±æµç¨‹
- `scripts/train_classifier.py` - è®­ç»ƒè„šæœ¬

#### éªŒæ”¶æ ‡å‡†
- [ ] å‡†ç¡®ç‡ >85% æ—¶å¯ç”¨
- [ ] æ¨ç†å»¶è¿Ÿ <10ms
- [ ] æ¨¡å‹å¤§å° <10MB

---

### Issue 7: æ¸è¿›å¼è¿›åº¦åé¦ˆ

**ä¼˜å…ˆçº§**: P2 (ä¸­)  
**å¤æ‚åº¦**: ä¸­  
**é¢„ä¼°å·¥æ—¶**: 2-3 å¤©

#### é—®é¢˜æè¿°
å½“å‰è¿›åº¦åé¦ˆè¾ƒç²—ç³™ï¼šthinking â†’ tool_use â†’ answerï¼Œç”¨æˆ·åœ¨é•¿æ—¶é—´ç­‰å¾…æ—¶ä¸æ¸…æ¥šè¿›åº¦ã€‚

#### å»ºè®®æ–¹æ¡ˆ

**åç«¯å¢åŠ ç»†ç²’åº¦äº‹ä»¶**:
```go
const (
    EventTypePhaseChange = "phase_change"
    EventTypeProgress    = "progress"
)

type PhaseChangeData struct {
    Phase         string  `json:"phase"`     // analyzing, planning, retrieving, synthesizing
    EstimatedMs   int     `json:"estimated_ms"`
    ToolsPlanned  []string `json:"tools_planned"`
}

type ProgressData struct {
    Phase     string  `json:"phase"`
    Progress  int     `json:"progress"`  // 0-100
    SubPhase  string  `json:"sub_phase"`
}
```

**å‰ç«¯æ¸²æŸ“**:
```tsx
function ProgressIndicator({ progress }) {
  return (
    <div className="progress-container">
      <div className="phase-label">{getPhaseLabel(progress.phase)}</div>
      <ProgressBar value={progress.progress} />
      <div className="tools-status">
        {progress.toolsInProgress.map(tool => (
          <ToolChip key={tool} name={tool} status="running" />
        ))}
      </div>
    </div>
  );
}
```

#### æ–‡ä»¶å˜æ›´
- `ai/agent/types.go` - æ·»åŠ æ–°äº‹ä»¶ç±»å‹
- `ai/agent/amazing_parrot.go` - å‘é€è¿›åº¦äº‹ä»¶
- `web/src/components/chat/ProgressIndicator.tsx` - æ–°ç»„ä»¶

#### éªŒæ”¶æ ‡å‡†
- [ ] æ¯ä¸ªé˜¶æ®µæœ‰æ˜ç¡®çš„è§†è§‰åé¦ˆ
- [ ] å·¥å…·æ‰§è¡Œè¿›åº¦å®æ—¶æ›´æ–°
- [ ] ç§»åŠ¨ç«¯é€‚é…

---

### Issue 8: æ™ºèƒ½å¿«æ·å›å¤ç”Ÿæˆ

**ä¼˜å…ˆçº§**: P2 (ä¸­)  
**å¤æ‚åº¦**: ä¸­  
**é¢„ä¼°å·¥æ—¶**: 2-3 å¤©

#### é—®é¢˜æè¿°
ç”¨æˆ·å®Œæˆä¸€è½®å¯¹è¯åï¼Œéœ€è¦æ‰‹åŠ¨è¾“å…¥ä¸‹ä¸€æ­¥æ“ä½œï¼Œå¢åŠ äº¤äº’æˆæœ¬ã€‚

#### å»ºè®®æ–¹æ¡ˆ

```go
func (p *AmazingParrot) GenerateQuickReplies(lastResponse string) []QuickReply {
    responseType := analyzeResponseType(lastResponse)
    
    switch responseType {
    case ResponseTypeScheduleCreated:
        return []QuickReply{
            {ID: "remind", Label: "è®¾ç½®æé†’", Prompt: "å¸®æˆ‘è®¾ç½®ä¼šè®®å‰15åˆ†é’Ÿæé†’"},
            {ID: "view", Label: "æŸ¥çœ‹å½“å¤©", Prompt: "æŸ¥çœ‹è¿™å¤©è¿˜æœ‰ä»€ä¹ˆå®‰æ’"},
            {ID: "modify", Label: "ä¿®æ”¹æ—¶é—´", Prompt: "æ”¹æˆå…¶ä»–æ—¶é—´"},
        }
    case ResponseTypeMemoFound:
        return []QuickReply{
            {ID: "more", Label: "æŸ¥çœ‹æ›´å¤š", Prompt: "è¿˜æœ‰å…¶ä»–ç›¸å…³çš„å—"},
            {ID: "schedule", Label: "åˆ›å»ºæ—¥ç¨‹", Prompt: "åŸºäºè¿™ä¸ªç¬”è®°åˆ›å»ºæ—¥ç¨‹"},
            {ID: "summarize", Label: "æ€»ç»“", Prompt: "å¸®æˆ‘æ€»ç»“è¿™äº›ç¬”è®°çš„è¦ç‚¹"},
        }
    // ...
    }
}
```

#### æ–‡ä»¶å˜æ›´
- `ai/agent/quick_replies.go` - å¿«æ·å›å¤ç”Ÿæˆé€»è¾‘
- `ai/agent/types.go` - QuickReply ç±»å‹å®šä¹‰
- `web/src/components/chat/QuickReplies.tsx` - å‰ç«¯ç»„ä»¶

#### éªŒæ”¶æ ‡å‡†
- [ ] æ ¹æ®ä¸Šä¸‹æ–‡åŠ¨æ€ç”Ÿæˆ
- [ ] æ”¯æŒè‡ªå®šä¹‰å¿«æ·å›å¤é…ç½®
- [ ] ç‚¹å‡»åè‡ªåŠ¨å‘é€

---

### Issue 9: ç«¯åˆ°ç«¯è¿½è¸ªç³»ç»Ÿ

**ä¼˜å…ˆçº§**: P2 (ä¸­)  
**å¤æ‚åº¦**: ä¸­  
**é¢„ä¼°å·¥æ—¶**: 2-3 å¤©

#### é—®é¢˜æè¿°
éš¾ä»¥è¿½è¸ªå•æ¬¡è¯·æ±‚çš„å®Œæ•´é“¾è·¯ï¼Œå®šä½æ€§èƒ½ç“¶é¢ˆå’Œé”™è¯¯æºå›°éš¾ã€‚

#### å»ºè®®æ–¹æ¡ˆ

```go
type TracingContext struct {
    TraceID   string
    SpanID    string
    StartTime time.Time
    
    Phases    map[string]*PhaseSpan
    ToolCalls []ToolCallSpan
    LLMCalls  []LLMCallSpan
}

type PhaseSpan struct {
    Name      string
    StartTime time.Time
    Duration  time.Duration
    Metadata  map[string]any
}

// åœ¨ AmazingParrot ä¸­ä½¿ç”¨
func (p *AmazingParrot) ExecuteWithCallback(...) error {
    trace := NewTracingContext()
    defer trace.Finish()
    
    trace.StartPhase("planning")
    plan, err := p.planRetrieval(ctx, ...)
    trace.EndPhase("planning")
    // ...
}
```

#### æ–‡ä»¶å˜æ›´
- `ai/tracing/context.go` - è¿½è¸ªä¸Šä¸‹æ–‡
- `ai/tracing/exporter.go` - å¯¼å‡ºåˆ°æ—¥å¿—/Jaeger
- `ai/agent/amazing_parrot.go` - åŸ‹ç‚¹

#### éªŒæ”¶æ ‡å‡†
- [ ] æ¯ä¸ªè¯·æ±‚ç”Ÿæˆå®Œæ•´ trace
- [ ] æ”¯æŒå¯¼å‡ºåˆ° Jaeger/Zipkin
- [ ] æä¾› trace æŸ¥è¯¢ API

---

### Issue 10: Prometheus æŒ‡æ ‡å¢å¼º

**ä¼˜å…ˆçº§**: P3 (ä½)  
**å¤æ‚åº¦**: ä½  
**é¢„ä¼°å·¥æ—¶**: 1 å¤©

#### é—®é¢˜æè¿°
ç¼ºå°‘ AI æ¨¡å—çš„ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§ã€‚

#### å»ºè®®æ–¹æ¡ˆ

```go
var (
    ChatLatency = prometheus.NewHistogramVec(
        prometheus.HistogramOpts{
            Namespace: "divinesense",
            Subsystem: "ai",
            Name:      "chat_latency_seconds",
            Buckets:   []float64{0.1, 0.5, 1, 2, 5, 10},
        },
        []string{"agent_type", "intent"},
    )
    
    ToolCallTotal = prometheus.NewCounterVec(
        prometheus.CounterOpts{
            Namespace: "divinesense",
            Subsystem: "ai",
            Name:      "tool_call_total",
        },
        []string{"tool_name", "success"},
    )
    
    CacheHitRate = prometheus.NewGaugeVec(
        prometheus.GaugeOpts{
            Namespace: "divinesense",
            Subsystem: "ai",
            Name:      "cache_hit_rate",
        },
        []string{"cache_layer"},
    )
)
```

#### æ–‡ä»¶å˜æ›´
- `ai/metrics/prometheus.go` - æŒ‡æ ‡å®šä¹‰
- `ai/agent/amazing_parrot.go` - åŸ‹ç‚¹
- `ai/agent/tools/*.go` - åŸ‹ç‚¹

#### éªŒæ”¶æ ‡å‡†
- [ ] è¦†ç›–æ ¸å¿ƒä¸šåŠ¡æŒ‡æ ‡
- [ ] Grafana ä»ªè¡¨æ¿æ¨¡æ¿

---

### Issue 11: æ•æ„Ÿä¿¡æ¯è¿‡æ»¤å™¨

**ä¼˜å…ˆçº§**: P3 (ä½)  
**å¤æ‚åº¦**: ä½  
**é¢„ä¼°å·¥æ—¶**: 1 å¤©

#### é—®é¢˜æè¿°
AI å›å¤å¯èƒ½æ„å¤–åŒ…å«ç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯ï¼ˆæ‰‹æœºå·ã€èº«ä»½è¯ç­‰ï¼‰ã€‚

#### å»ºè®®æ–¹æ¡ˆ

```go
type SensitiveFilter struct {
    patterns []*regexp.Regexp
    masks    map[string]string
}

var defaultPatterns = []*regexp.Regexp{
    regexp.MustCompile(`\b1[3-9]\d{9}\b`),           // æ‰‹æœºå·
    regexp.MustCompile(`\b\d{17}[\dXx]\b`),          // èº«ä»½è¯
    regexp.MustCompile(`[\w.-]+@[\w.-]+\.\w+`),      // é‚®ç®±
    regexp.MustCompile(`\d{4}[\s-]?\d{4}[\s-]?\d{4}[\s-]?\d{4}`), // é“¶è¡Œå¡
}

func (f *SensitiveFilter) Filter(output string) string {
    for _, pattern := range f.patterns {
        output = pattern.ReplaceAllStringFunc(output, func(s string) string {
            return maskSensitive(s)
        })
    }
    return output
}
```

#### æ–‡ä»¶å˜æ›´
- `ai/security/sensitive_filter.go` - è¿‡æ»¤å™¨å®ç°
- `ai/agent/amazing_parrot.go` - åœ¨ synthesis ååº”ç”¨

#### éªŒæ”¶æ ‡å‡†
- [ ] è¦†ç›–å¸¸è§æ•æ„Ÿä¿¡æ¯ç±»å‹
- [ ] æ”¯æŒè‡ªå®šä¹‰è§„åˆ™
- [ ] è®°å½•è¿‡æ»¤æ—¥å¿—

---

### Issue 12: é¢„æµ‹æ€§é¢„åŠ è½½

**ä¼˜å…ˆçº§**: P3 (ä½)  
**å¤æ‚åº¦**: é«˜  
**é¢„ä¼°å·¥æ—¶**: 5-7 å¤©

#### é—®é¢˜æè¿°
ç”¨æˆ·é¦–æ¬¡æŸ¥è¯¢æ—¶éœ€è¦å®Œæ•´çš„æ£€ç´¢æµç¨‹ï¼Œå»¶è¿Ÿè¾ƒé«˜ã€‚

#### å»ºè®®æ–¹æ¡ˆ

```go
type PredictiveLoader struct {
    userPatterns map[int32]*UserPattern
    scheduler    *cron.Scheduler
}

type UserPattern struct {
    MorningScheduleQuery    bool      // é€šå¸¸æ—©ä¸ŠæŸ¥æ—¥ç¨‹
    FrequentMemoTopics      []string  // å¸¸æœç´¢çš„ç¬”è®°ä¸»é¢˜
    ActiveHours             []int     // æ´»è·ƒæ—¶æ®µ
}

func (l *PredictiveLoader) PrefetchForUser(userID int32) {
    pattern := l.userPatterns[userID]
    
    if pattern.MorningScheduleQuery && isMorning() {
        go l.warmupScheduleCache(userID, "today")
    }
    
    for _, topic := range pattern.FrequentMemoTopics {
        go l.warmupMemoEmbedding(userID, topic)
    }
}
```

#### æ–‡ä»¶å˜æ›´
- `ai/prefetch/loader.go` - é¢„åŠ è½½å™¨
- `ai/prefetch/patterns.go` - ç”¨æˆ·æ¨¡å¼åˆ†æ
- `server/cron/prefetch_job.go` - å®šæ—¶ä»»åŠ¡

#### éªŒæ”¶æ ‡å‡†
- [ ] åŸºäºå†å²è¡Œä¸ºåˆ†æç”¨æˆ·æ¨¡å¼
- [ ] åå°å®šæ—¶é¢„åŠ è½½
- [ ] ä¸å½±å“ç³»ç»Ÿè´Ÿè½½ï¼ˆèµ„æºé™åˆ¶ï¼‰

---

## æ‰§è¡Œè®¡åˆ’

### Phase 1 (Week 1-2): åŸºç¡€æ€§èƒ½ä¼˜åŒ–
- Issue 1: è¯­ä¹‰ç¼“å­˜å±‚
- Issue 2: æ£€ç´¢ç»“æœç¼“å­˜
- Issue 3: åŠ¨æ€ Token é¢„ç®—

### Phase 2 (Week 3-4): è·¯ç”±ä¸ä½“éªŒä¼˜åŒ–
- Issue 5: è§„åˆ™è·¯ç”±æƒé‡
- Issue 7: æ¸è¿›å¼è¿›åº¦åé¦ˆ
- Issue 8: æ™ºèƒ½å¿«æ·å›å¤

### Phase 3 (Week 5-6): é«˜çº§ç‰¹æ€§
- Issue 4: å¢é‡ä¸Šä¸‹æ–‡
- Issue 9: ç«¯åˆ°ç«¯è¿½è¸ª
- Issue 10: Prometheus æŒ‡æ ‡

### Phase 4 (Week 7-8): ç ”ç©¶æ€§ç‰¹æ€§
- Issue 6: ML æ„å›¾åˆ†ç±»å™¨
- Issue 11: æ•æ„Ÿä¿¡æ¯è¿‡æ»¤
- Issue 12: é¢„æµ‹æ€§é¢„åŠ è½½
