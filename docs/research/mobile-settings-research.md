# 调研报告：移动端设置菜单体验优化

## 理解你的 Idea

**核心需求**：优化设置菜单的移动端体验，并针对移动端场景裁剪/调整功能集，避免简单的 PC 端复刻。

**关键问题**：
1. **痛点细节**：目前的设置菜单在移动端最大的阻碍是什么？（操作层级深、表格无法显示、信息过载）
2. **功能差异化**：哪些功能是“PC 端专属”？（API Key 管理、Prompt 调试、知识库导入）
3. **技术载体**：响应式 Web 页面优化。

**扩展方向**：
- **Mobile-First UI 重构**：放弃侧边栏布局，改用列表+抽屉（Bottom Sheet）。
- **场景化功能分级**：隐藏生产级配置。

---

## 调研报告

### 技术可行性
- **评级**: **高**
- **方案**:
    - **响应式布局升级**: 使用 `shadcn/ui` 的 Sheet (抽屉) 替代 Dialog/Modal 在移动端的展示。
    - **设备检测**: 引入 `react-use` 或自定义 hook (`useMediaQuery`) 在组件层区分移动/桌面端逻辑。
    - **路由重构**: 移动端设置页采用独立的 `/m/settings` 路由或在现有路由上根据 Viewport 动态渲染不同的 Layout（如将侧边栏改为底部导航或全屏列表）。
- **影响**: **中等改动**。主要集中在 `web/src/components/Settings` 目录下的组件拆分和 Layout 适配，后端 API 无需变更。

### 用户价值
- **解决问题**: 解决移动端操作困难（误触、无法完整显示表格）和信息过载（显示不需要的高级配置）的痛点。
- **目标用户**: 所有在手机上使用 DivineSense 的用户，特别是快速查看状态或简单开关配置的场景。
- **使用频率**: **中**。虽然设置不是高频操作，但糟糕的体验会严重阻断用户留存。

### 竞品分析
- **参考**:
    - **Telegram (Mobile)**: 设置页采用分组列表，点击进入二级页的导航模式，而非 PC端的弹窗或侧栏。
    - **Notion (Mobile)**: 极简设置，隐藏了复杂的 workspace 管理功能，仅保留个人偏好和通知。
    - **Linear (Mobile)**: 针对移动端重写了完全不同的交互流，大量使用 Bottom Sheet。

### 复杂度
- **工作量**: **1.5 人周**
    - 0.5 周：拆分现有设置组件（解耦 PC/Mobile 逻辑）。
    - 0.5 周：实现移动端专属 Layout 和交互组件（Sheet, List）。
    - 0.5 周：UI 调整和测试。
- **风险点**: 维护两套 UI 的成本增加；需要确保响应式切换时的状态同步。
- **依赖项**: 无硬性阻塞，建议依赖 `shadcn/ui` 组件库的 Drawer/Sheet 组件。

---

## 方案设计

### 功能边界
**包含**：
- **移动端专属导航**: 抛弃左侧树状菜单，改为一级列表页 -> 二级详情页。
- **UI 适配**:
    - 将所有表格（如 Chat Apps 凭证列表）在移动端改写为 Card/List 视图。
    - 所有弹窗（Dialog）在移动端自动降级为全屏抽屉（Sheet/Drawer）。
- **功能裁剪**:
    - **隐藏**: 知识库导入/导出、复杂的 Prompt 调试、API Key 管理（仅展示状态，不支持移动端复制/编辑）。
    - **保留**: 个人资料、语言切换、通知开关、Chat Apps 简单开关。

**不包含**：
- Native App 开发（本次仅限于 Web 响应式适配）。
- 移动端特有的新功能（如震动反馈、原生推送），仅做现有功能适配。

### 技术方案
**前端**：
- **Hook**: `useIsMobile()` 基于 `window.innerWidth < 768px`。
- **组件策略**:
    ```tsx
    // 伪代码示例
    return isMobile ? (
       <MobileSettingsLayout>
          <MyAccountSection />
          <PreferencesSection />
       </MobileSettingsLayout>
    ) : (
       <DesktopSettingsModal>...</DesktopSettingsModal>
    );
    ```
- **样式**: 使用 TailwindCSS 的 `hidden md:block` 等工具类控制显隐。

**后端**：
- 无变更。

### 风险与缓解
| 风险                         | 影响 | 措施                                                                |
| :--------------------------- | :--- | :------------------------------------------------------------------ |
| PC/Mobile 代码分叉导致维护难 | 中   | 保持核心逻辑（Form 提交、数据 Fetch）在 Hook 层复用，仅 UI 层分离。 |
| 误判平板设备                 | 低   | 采用基于 CSS 媒体查询的显隐控制为主，JS 判断为辅。                  |
