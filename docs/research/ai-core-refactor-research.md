# AI Core æ¨¡å—æå‡é‡æ„è°ƒç ”æŠ¥å‘Š

> **è°ƒç ”æ—¥æœŸ**: 2026-02-02
> **ç‰ˆæœ¬**: v1.0
> **å…³è” Issue**: [#51](https://github.com/hrygo/divinesense/issues/51)
> **Co-Authored-By**: Claude Opus 4.5

---

## é—®é¢˜æœ¬è´¨

AI åŠŸèƒ½è¢«æ”¾åœ¨ `plugin/ai/` ç›®å½•ä¸‹ï¼Œæš—ç¤ºå®ƒæ˜¯"å¯é€‰æ’ä»¶"åœ°ä½ï¼Œä½†å®é™…ä¸Š AI æ˜¯ DivineSense çš„**æ ¸å¿ƒå–ç‚¹**ã€‚

```
plugin/
â”œâ”€â”€ ai/          â† AI åŠŸèƒ½ï¼ˆä¸ email/cron/webhook åŒçº§ï¼‰
â”œâ”€â”€ cron/
â”œâ”€â”€ email/
â”œâ”€â”€ filter/
â”œâ”€â”€ idp/
â”œâ”€â”€ markdown/
â”œâ”€â”€ ocr/
â”œâ”€â”€ scheduler/
â”œâ”€â”€ textextract/
â””â”€â”€ webhook/
```

**æ ¸å¿ƒçŸ›ç›¾**ï¼š
- AI ä¸æ˜¯ Pluginï¼Œæ˜¯ Core
- å½“å‰ç›®å½•ç»“æ„æš—ç¤ºäº†"äºŒç­‰å…¬æ°‘"åœ°ä½
- AI ä»£ç åŒæ—¶åˆ†æ•£åœ¨ `server/ai/` å’Œ `server/retrieval/`

---

## å½“å‰ AI ä»£ç åˆ†å¸ƒï¼ˆå‰²è£‚çŠ¶æ€ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å½“å‰ AI ä»£ç åˆ†å¸ƒï¼ˆå‰²è£‚çŠ¶æ€ï¼‰                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  plugin/ai/           â”‚  server/           â”‚  store/          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚  agent/               â”‚  ai/               â”‚  db/postgres/    â”‚
â”‚  â”œâ”€ 5 ä¸ªä»£ç†          â”‚  â”œâ”€ chunker.go     â”‚  â”œâ”€ memo_embeddingâ”‚
â”‚  â”œâ”€ router/           â”‚  â”œâ”€ embedder.go    â”‚  â”œâ”€ ai_conversationâ”‚
â”‚  â”œâ”€ vector/           â”‚  â””â”€ provider.go    â”‚  â”œâ”€ episodic_memoryâ”‚
â”‚  â”œâ”€ memory/           â”‚                    â”‚  â””â”€ conversation_ â”‚
â”‚  â”œâ”€ session/          â”‚  retrieval/        â”‚     context       â”‚
â”‚  â”œâ”€ cache/            â”‚  â””â”€ adaptive_      â”‚                  â”‚
â”‚  â”œâ”€ rag/              â”‚     retrieval.go   â”‚                  â”‚
â”‚  â”œâ”€ schedule/         â”‚  (766 è¡Œ!)         â”‚                  â”‚
â”‚  â”œâ”€ context/          â”‚                    â”‚                  â”‚
â”‚  â”œâ”€ tags/             â”‚  router/api/v1/ai/ â”‚                  â”‚
â”‚  â”œâ”€ duplicate/        â”‚  â”œâ”€ handler.go     â”‚                  â”‚
â”‚  â”œâ”€ habit/            â”‚  â”œâ”€ factory.go     â”‚                  â”‚
â”‚  â”œâ”€ genui/            â”‚  â”œâ”€ middleware.go  â”‚                  â”‚
â”‚  â”œâ”€ graph/            â”‚  â””â”€ *_service.go   â”‚                  â”‚
â”‚  â”œâ”€ prediction/       â”‚     (å¤šä¸ªæœåŠ¡)     â”‚                  â”‚
â”‚  â”œâ”€ reminder/         â”‚                    â”‚                  â”‚
â”‚  â”œâ”€ aitime/           â”‚  runner/           â”‚                  â”‚
â”‚  â”œâ”€ timeout/          â”‚  â”œâ”€ embedding/     â”‚                  â”‚
â”‚  â””â”€ review/           â”‚  â””â”€ ocr/           â”‚                  â”‚
â”‚                       â”‚                    â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ ¸å¿ƒæ¶æ„é—®é¢˜

| é—®é¢˜ | ç°è±¡ | å½±å“ç­‰çº§ |
|:-----|:-----|:---------|
| **æ£€ç´¢ç³»ç»Ÿé‡å¤** | `server/retrieval/adaptive_retrieval.go` (766è¡Œ) ä¸ `plugin/ai/rag/` åŠŸèƒ½é‡å  | ğŸ”´ é«˜ |
| **åµŒå…¥æœåŠ¡åˆ†æ•£** | `server/ai/embedder.go` å¤„ç† Memoï¼Œ`plugin/ai/vector/` å¤„ç†æŸ¥è¯¢ | ğŸ”´ é«˜ |
| **è·¯ç”±ç³»ç»Ÿä¸¤å¥—** | `ChatRouter` (agent/) å’Œ `router.Service` (router/) å¹¶å­˜ | ğŸŸ¡ ä¸­ |
| **æ•°æ®å±‚å‰²è£‚** | AI ç›¸å…³è¡¨æ•£è½åœ¨ `store/db/postgres/` å„å¤„ | ğŸŸ¡ ä¸­ |
| **API å±‚è†¨èƒ€** | `server/router/api/v1/ai/` åŒ…å«å¤šä¸ª `_service.go` æ–‡ä»¶ | ğŸŸ¡ ä¸­ |

---

## è§£å†³æ–¹æ¡ˆï¼šæ–¹æ¡ˆ Aï¼ˆAI æå‡ä¸ºä¸€çº§æ¨¡å—ï¼‰

### æ–°ç›®å½•ç»“æ„

```
divinesense/
â”œâ”€â”€ cmd/                  # å…¥å£
â”œâ”€â”€ server/               # HTTP/gRPC æœåŠ¡å™¨å±‚
â”œâ”€â”€ ai/                   # ğŸ”´ NEW: AI æ ¸å¿ƒæ¨¡å—ï¼ˆä» plugin/ai æå‡ï¼‰
â”‚   â”œâ”€â”€ core/             #   AI åŸºç¡€è®¾æ–½
â”‚   â”‚   â”œâ”€â”€ embedding/    #     åµŒå…¥æœåŠ¡ï¼ˆä» server/ai/ è¿ç§»ï¼‰
â”‚   â”‚   â”œâ”€â”€ retrieval/    #     æ£€ç´¢ç³»ç»Ÿï¼ˆä» server/retrieval/ è¿ç§»ï¼‰
â”‚   â”‚   â”œâ”€â”€ reranker/     #     é‡æ’æœåŠ¡
â”‚   â”‚   â””â”€â”€ llm/          #     LLM å®¢æˆ·ç«¯
â”‚   â”‚
â”‚   â”œâ”€â”€ store/            #   AI æ•°æ®å­˜å‚¨é€‚é…å±‚ï¼ˆæ–°å¢ï¼‰
â”‚   â”‚   â”œâ”€â”€ interface.go
â”‚   â”‚   â”œâ”€â”€ embedding.go
â”‚   â”‚   â”œâ”€â”€ conversation.go
â”‚   â”‚   â”œâ”€â”€ memory.go
â”‚   â”‚   â””â”€â”€ postgres/
â”‚   â”‚
â”‚   â”œâ”€â”€ agent/            #   ä»£ç†ç³»ç»Ÿ
â”‚   â”œâ”€â”€ router/           #   æ„å›¾è·¯ç”±
â”‚   â”œâ”€â”€ memory/           #   è®°å¿†ç³»ç»Ÿ
â”‚   â”œâ”€â”€ session/          #   ä¼šè¯ç®¡ç†
â”‚   â”œâ”€â”€ cache/            #   ç¼“å­˜æœåŠ¡
â”‚   â”œâ”€â”€ metrics/          #   æ€§èƒ½ç›‘æ§
â”‚   â”œâ”€â”€ context/          #   ä¸Šä¸‹æ–‡æ„å»º
â”‚   â”‚
â”‚   â”œâ”€â”€ rag/              #   RAG é«˜çº§åŠŸèƒ½
â”‚   â”œâ”€â”€ tags/             #   æ ‡ç­¾å»ºè®®
â”‚   â”œâ”€â”€ duplicate/        #   é‡å¤æ£€æµ‹
â”‚   â”œâ”€â”€ habit/            #   ä¹ æƒ¯å­¦ä¹ 
â”‚   â”œâ”€â”€ genui/            #   ç”Ÿæˆå¼ UI
â”‚   â”œâ”€â”€ graph/            #   çŸ¥è¯†å›¾è°±
â”‚   â”œâ”€â”€ prediction/       #   é¢„æµ‹å¼•æ“
â”‚   â”œâ”€â”€ reminder/         #   æé†’ç³»ç»Ÿ
â”‚   â”œâ”€â”€ schedule/         #   æ—¥ç¨‹ AI
â”‚   â”œâ”€â”€ aitime/           #   AI æ—¶é—´è§£æ
â”‚   â”œâ”€â”€ timeout/          #   è¶…æ—¶å¤„ç†
â”‚   â”œâ”€â”€ review/           #   å®¡æŸ¥æœåŠ¡
â”‚   â”‚
â”‚   â””â”€â”€ config.go         #   AI é…ç½®
â”‚
â”œâ”€â”€ plugin/               # å…¶ä»–å¯é€‰æ’ä»¶ï¼ˆé AIï¼‰
â”œâ”€â”€ store/                # æ•°æ®å­˜å‚¨å±‚ï¼ˆé€šç”¨ï¼‰
â”œâ”€â”€ proto/                # åè®®å®šä¹‰
â”œâ”€â”€ web/                  # å‰ç«¯
â””â”€â”€ docs/                 # æ–‡æ¡£
```

### Import è·¯å¾„æ˜ å°„

| æ—§è·¯å¾„ | æ–°è·¯å¾„ |
|:-------|:-------|
| `github.com/hrygo/divinesense/plugin/ai` | `github.com/hrygo/divinesense/ai` |
| `github.com/hrygo/divinesense/server/retrieval` | `github.com/hrygo/divinesense/ai/core/retrieval` |
| `github.com/hrygo/divinesense/server/ai` | `github.com/hrygo/divinesense/ai/core/embedding` |

---

## è¿ç§»è§„æ¨¡

| ç›®æ ‡è·¯å¾„ | å¼•ç”¨æ•°é‡ | æ–‡ä»¶æ•°é‡ |
|:---------|:---------|:---------|
| `plugin/ai` | 79 å¤„ | 59 ä¸ªæ–‡ä»¶ |
| `server/retrieval` | 7 å¤„ | 7 ä¸ªæ–‡ä»¶ |
| **æ€»è®¡** | **86 å¤„** | **çº¦ 66 ä¸ªæ–‡ä»¶** |

---

## è¿ç§»è·¯å¾„

```
é˜¶æ®µ 0: å‡†å¤‡ (1 å¤©)
â”œâ”€â”€ å¤‡ä»½å½“å‰åˆ†æ”¯
â”œâ”€â”€ åˆ›å»ºè¿ç§»åˆ†æ”¯ feat/ai-core-promotion
â”œâ”€â”€ ç¼–å†™è¿ç§»è„šæœ¬
â””â”€â”€ åˆ›å»ºæ–°ç›®å½•ç»“æ„

é˜¶æ®µ 1: ç›®å½•è¿ç§» (1 å¤©)
â”œâ”€â”€ è¿ç§» plugin/ai/* â†’ ai/*
â”œâ”€â”€ è¿ç§» server/ai/* â†’ ai/core/embedding/*
â”œâ”€â”€ è¿ç§» server/retrieval/* â†’ ai/core/retrieval/*
â”œâ”€â”€ åˆ é™¤ç©ºç›®å½•
â””â”€â”€ æ›´æ–° package å£°æ˜

é˜¶æ®µ 2: Import æ›´æ–° (2 å¤©)
â”œâ”€â”€ æ‰§è¡Œæ‰¹é‡æ›¿æ¢
â”œâ”€â”€ æ‰‹åŠ¨æ£€æŸ¥é—æ¼
â”œâ”€â”€ æ›´æ–° go.mod
â””â”€â”€ è¿è¡Œ go mod tidy

é˜¶æ®µ 3: Store å±‚ç»Ÿä¸€ (2 å¤©)
â”œâ”€â”€ åˆ›å»º ai/store/ æ¥å£
â”œâ”€â”€ å®ç° PostgreSQL é€‚é…å™¨
â”œâ”€â”€ æ›´æ–° agent/ è°ƒç”¨
â””â”€â”€ è¿ç§» AI ç›¸å…³è¡¨æ“ä½œ

é˜¶æ®µ 4: æµ‹è¯•éªŒè¯ (2 å¤©)
â”œâ”€â”€ å•å…ƒæµ‹è¯•
â”œâ”€â”€ é›†æˆæµ‹è¯•
â”œâ”€â”€ AI åŠŸèƒ½å›å½’æµ‹è¯•
â””â”€â”€ æ€§èƒ½åŸºå‡†æµ‹è¯•

é˜¶æ®µ 5: æ–‡æ¡£æ›´æ–° (1 å¤©)
â”œâ”€â”€ æ›´æ–° ARCHITECTURE.md
â”œâ”€â”€ æ›´æ–° BACKEND_DB.md
â”œâ”€â”€ æ›´æ–° PROJECT_PATHS.md
â””â”€â”€ æ›´æ–° README.md

é˜¶æ®µ 6: æ¸…ç†ä¸å‘å¸ƒ (1 å¤©)
â”œâ”€â”€ ä»£ç å®¡æŸ¥
â”œâ”€â”€ åˆå¹¶åˆ° main
â””â”€â”€ å‘å¸ƒæ–°ç‰ˆæœ¬
```

---

## é£é™©ä¸ç¼“è§£

| é£é™© | å½±å“ | æ¦‚ç‡ | æªæ–½ |
|:-----|:-----|:-----|:-----|
| Import è·¯å¾„é—æ¼ | é«˜ | ä¸­ | ç¼–å†™ linter æ£€æµ‹æ—§è·¯å¾„ |
| package å£°æ˜é”™è¯¯ | é«˜ | ä½ | è‡ªåŠ¨åŒ–è„šæœ¬ + æ‰‹åŠ¨éªŒè¯ |
| æµ‹è¯•è¦†ç›–ä¸è¶³ | ä¸­ | ä¸­ | è¿ç§»å‰è¡¥å……æµ‹è¯• |
| æ„å»ºå¤±è´¥ | é«˜ | ä½ | é˜¶æ®µæ€§æ„å»ºéªŒè¯ |

---

## å‚è€ƒèµ„æº

- [LangChain Architecture](https://python.langchain.com/docs/get_started/introduction)
- [LangGraph](https://langchain-ai.github.io/langgraph/)
- [Semantic Kernel](https://learn.microsoft.com/en-us/semantic-kernel/)

---

**é¢„è®¡å·¥æœŸ**: 8-10 äººå¤©
**å¤æ‚åº¦**: ä¸­-é«˜
**å‘åå…¼å®¹**: æ˜¯ï¼ˆä»…è¿ç§»ä½ç½®ï¼ŒAPI ä¸å˜ï¼‰
