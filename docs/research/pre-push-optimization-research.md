# Pre-push æ€§èƒ½ä¼˜åŒ–è°ƒç ”æŠ¥å‘Š

> **ç›®æ ‡**: å°† pre-push æ£€æŸ¥æ—¶é—´ä» ~180 ç§’å‹ç¼©åˆ° 50 ç§’ä»¥å†…
> 
> **è°ƒç ”æ—¥æœŸ**: 2026-02-09
> 
> **å…³è” Issue**: [#129](https://github.com/hrygo/divinesense/issues/129)

---

## ä¸€ã€é—®é¢˜åˆ†æ

### 1.1 å½“å‰è€—æ—¶åˆ†å¸ƒ

| é˜¶æ®µ | è€—æ—¶ | å æ¯” |
|:-----|:-----|:-----|
| go mod tidy | ~1s | <1% |
| golangci-lint | ~15s | 8% |
| go test | ~165s | 92% |
| **æ€»è®¡** | **~180s** | 100% |

### 1.2 ç“¶é¢ˆè¯†åˆ«

**Top 5 æ…¢é€Ÿæµ‹è¯•åŒ…**ï¼š

| åŒ… | è€—æ—¶ | ä¸»è¦åŸå›  |
|:-----|:-----|:---------|
| `plugin/cron` | 46.8s | ğŸ”´ ç¡¬ç¼–ç  time.Sleep |
| `ai/review` | 7.8s | ğŸŸ¡ æ—¶é—´ç›¸å…³æµ‹è¯• |
| `ai/reminder` | 8.1s | ğŸŸ¡ æ—¶é—´ç›¸å…³æµ‹è¯• |
| `plugin/email` | 8.3s | ğŸŸ¡ æ—¶é—´ç›¸å…³æµ‹è¯• |
| `server/auth` | 8.6s | ğŸŸ¡ é›†æˆæµ‹è¯• |

---

## äºŒã€plugin/cron æ ¹å› åˆ†æ

### 2.1 æ ¸å¿ƒå‘ç°

- **æ€»æµ‹è¯•æ•°**: 48 ä¸ª
- **æ…¢é€Ÿæµ‹è¯•ï¼ˆ>1sï¼‰**: 23 ä¸ª
- **æ— å¤–éƒ¨ä¾èµ–**: âœ… çº¯æ—¶é—´ç­‰å¾…

### 2.2 å…³é”®å¸¸é‡

```go
// plugin/cron/cron_test.go:18
const OneSecond = 1*time.Second + 50*time.Millisecond  // 1050ms
```

**å½±å“**: 15+ ä¸ªæµ‹è¯•ä½¿ç”¨æ­¤å¸¸é‡ã€‚

### 2.3 æ…¢é€Ÿæµ‹è¯• Top 5

| æ’å | æµ‹è¯•åç§° | è€—æ—¶ | æ ¹å› ä»£ç  |
|:-----|:---------|:-----|:---------|
| 1 | `TestStopAndWait/repeated_calls_to_stop...` | 7.00s | `Sleep(2s)` + `After(1.5s)` + `After(1s)` |
| 2 | `TestAddWhileRunningWithDelay` | 6.05s | `Sleep(5s)` + `OneSecond` |
| 3 | `TestScheduleAfterRemoval` | 3.00s | `After(5s)` + `After(5s)` + `After(3s)` |
| 4 | `TestLocalTimezone` | 2.00s | è¾¹ç•Œå¤„ç† `Sleep(2s)` + `After(2.1s)` |
| 5 | `TestNonLocalTimezone` | 2.00s | åŒä¸Š |

---

## ä¸‰ã€è§£å†³æ–¹æ¡ˆ

### 3.1 æ™ºèƒ½åˆ†å±‚ç­–ç•¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  pre-commit (~5s)                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  âœ… go mod tidy -diff                                        â”‚
â”‚  âœ… go fmt ./...                                              â”‚
â”‚  âœ… go vet ./...                                              â”‚
â”‚  âœ… go test -short -run '^(Test(Chain|Parser|Spec))' ./plugin/cron/...  â”‚
â”‚  âœ… go test -short ./ai/...                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  pre-push (~45s)                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  âœ… go mod tidy check                                        â”‚
â”‚  âœ… golangci-lint (15s)                                      â”‚
â”‚  âœ… go test -short -timeout=60s -tags=noui ./... (30s)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CI (GitHub Actions)                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  âœ… golangci-lint                                            â”‚
â”‚  âœ… go test -race -cover ./...                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Cron æµ‹è¯•ä¼˜åŒ–

| æ–‡ä»¶ | è¡Œå· | å˜æ›´ | æ”¶ç›Š |
|:-----|:-----|:-----|:-----|
| `plugin/cron/cron_test.go` | 18 | `OneSecond: 1050ms â†’ 400ms` | ~10s |
| `plugin/cron/cron_test.go` | 150 | `Sleep(5s) â†’ Sleep(1s)` | 4s |
| `plugin/cron/cron_test.go` | 680 | `After(1500ms) â†’ After(500ms)` | 1s |

---

## å››ã€é¢„æœŸæ•ˆæœ

| é˜¶æ®µ | å½“å‰ | ä¼˜åŒ–å | æå‡ |
|:-----|:-----|:-------|:-----|
| pre-commit | ~2s | ~5s | +3s |
| pre-push | ~180s | **~45s** | **-75%** |
| æ€»è®¡ | ~182s | **~50s** | **-73%** |

---

## äº”ã€å®æ–½è®¡åˆ’

1. âœ… åˆ›å»º Issue #129
2. â³ ä¿®æ”¹ `plugin/cron/cron_test.go`
3. â³ æ›´æ–° `.git/hooks/pre-commit`
4. â³ æ›´æ–° `Makefile`
5. â³ éªŒè¯æ•ˆæœ
6. â³ æ›´æ–°æ–‡æ¡£

---

*è°ƒç ”å®Œæˆäº 2026-02-09*
