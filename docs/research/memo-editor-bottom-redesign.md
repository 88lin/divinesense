# 笔记编辑器移动到底部 + 渐进式展开设计 - 调研报告

> **调研日期**: 2026-02-08
> **Issue**: [#123](https://github.com/hrygo/divinesense/issues/123)
> **状态**: 已完成

---

## 1. 需求概述

### 核心问题
- 当前 Home 页面编辑器位于列表顶部，移动端体验不佳
- 与 AIChat 页面底部输入体验不一致
- 需要统一的底部输入模式，同时适配移动端和 PC 端

### 目标
- 将 `MemoEditor` 移至底部固定位置
- 实现渐进式展开设计
- 移动端简化功能，PC 端全量功能

---

## 2. 技术可行性

### 现状分析

**当前 `MemoEditor` 功能清单**：
| 功能类别 | 具体能力 | 移动端适配 |
|:---------|:---------|:-----------|
| 文本编辑 | 自适应高度、Enter发送、快捷键 | ✅ |
| 工具栏 | 文件上传、链接笔记、位置标记、聚焦模式、斜杠命令 | ⚠️ 移动端较拥挤 |
| 智能辅助 | 标签建议 `#`、斜杠命令 `/`、列表自动续写 | ✅ |
| 元数据 | 可见性、关系、附件、位置 | ✅ |
| 自动保存 | localStorage、防抖、缓存恢复 | ✅ |
| 聚焦模式 | 全屏体验、退出按钮、遮罩层 | ✅ |

**当前位置**：`PagedMemoList.tsx` 列表顶部（第 159-161 行）

### 技术方案
- **评级**: 高
- **影响**: 前端中等改动，后端无影响
- **复用**: 可复用 `ChatInput` 的底部固定和虚拟键盘适配逻辑

---

## 3. 业界最佳实践

| 产品 | 移动端输入位置 | PC 端输入位置 | 特点 |
|:-----|:--------------|:-------------|:-----|
| **Notion** | 底部固定 + 展开式编辑器 | 页面内嵌入 | 移动端简化，PC 端全功能 |
| **Evernote** | 底部固定 + 快速笔记 | 顶部工具栏 + 编辑区 | 分层设计明显 |
| **Apple Notes** | 底部快速输入 + 全屏编辑 | 列表顶部 + 详情页编辑 | 双模式清晰 |
| **Flomo** | 底部悬浮按钮 + 简化输入 | 同移动端 | 极简主义 |

### 设计原则（基于 NNGroup 研究）
1. Bottom Sheet 适用于临时交互和快速输入
2. 应该支持 Back 按钮关闭
3. 移动端输入框需适配虚拟键盘动态高度

---

## 4. 方案设计

### 4.1 功能分层设计

```
┌─────────────────────────────────────────────────────────┐
│  [笔记列表 - 时间线]                                    │
│  ┌─────────────────────────────────────────────────────┐│
│  │ 📝 今天完成了 xxx #work                           ││
│  │ 📝 买牛奶 #life                                    ││
│  └─────────────────────────────────────────────────────┘│
│                                                         │
│  ┌─────────────────────────────────────────────────────┐│
│  │ ┌─────────────────────────────────────────────────┐ ││
│  │ │ [快速记录想法...]                       [⚡]  [✓]│ ││ ← 默认折叠态
│  │ └─────────────────────────────────────────────────┘ ││
│  │  [📎] [🔗] [📍]  ← 展开后显示（滑出面板）         │ ││
│  └─────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────┘
```

| 模式 | 触发方式 | 功能范围 | 适用场景 |
|:-----|:---------|:---------|:---------|
| **快速模式** | 底部固定框（默认） | 纯文本 + 标签 `#` | 3-10秒快速记录 |
| **标准模式** | 点击 ⚡ 展开按钮 | 快速模式 + 文件上传、链接笔记、位置 | 需要附件或关联时 |
| **聚焦模式** | 点击全屏图标/快捷键 | 全部功能 + 完整工具栏 | 深度编辑 |

### 4.2 平台差异化

| 平台 | 默认模式 | 工具栏呈现 | 聚焦模式 |
|:-----|:---------|:-----------|:---------|
| **移动端** | 快速模式（紧凑） | 底部滑出式面板（iOS Share Sheet 风格） | 全屏覆盖 |
| **PC 端** | 标准模式（展开） | 侧边/顶部全量工具栏 | 模态对话框 |

### 4.3 组件重构

```
web/src/components/MemoEditor/
├── index.tsx              ← 主入口（响应式分发）
├── QuickInput.tsx         ← 快速模式（新增，复用 ChatInput）
├── StandardEditor.tsx     ← 标准模式（现有功能重构）
├── FocusEditor.tsx        ← 聚焦模式（现有）
├── hooks/
│   ├── useAutoSave.ts
│   ├── useVirtualKeyboard.ts
│   └── useEditorMode.ts   ← 新增：模式切换管理
└── toolbar/
    ├── QuickToolbar.tsx   ← 移动端滑出工具栏（新增）
    └── FullToolbar.tsx    ← PC 端全量工具栏
```

### 4.4 布局变更

**修改 `MemoLayout.tsx`**：
- 移除列表顶部的编辑器位置
- 在底部固定区域添加 `MemoEditor` 容器

**修改 `PagedMemoList.tsx`**：
- 移除 `prefixElement` 中的 `MemoEditor`
- 简化列表渲染逻辑

---

## 5. 风险与缓解

| 风险 | 影响 | 措施 |
|:-----|:-----|:-----|
| 现有功能回归 | 中 | 完整回归测试，保留原有 API |
| 移动端工具栏交互 | 中 | 参考 iOS Share Sheet 成熟模式 |
| 模式切换状态管理 | 低 | 使用有限状态机管理模式 |

---

## 6. 复杂度评估

- **工作量**: 2-3 人周
  - 组件重构: 5-7 天
  - 响应式适配: 2-3 天
  - 测试与调优: 2-3 天
- **风险**: 中
- **依赖**: 无

---

## 7. 验收标准

- [x] `make check-all` 通过
- [x] 移动端编辑器固定底部，键盘弹出时自动适配
- [x] PC 端编辑器固定底部，全量工具栏正常工作
- [x] 三种模式切换流畅，状态管理正确
- [x] 自动保存功能正常
- [x] 标签 `#tag` 输入和联想功能正常

**实施完成日期**: 2026-02-09

---

*调研完成时间: 2026-02-08*
