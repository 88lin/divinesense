# @ æŒ‡ä»¤éšå¼è·¯ç”±ä¼˜åŒ–è°ƒç ”æŠ¥å‘Š

> **Issue**: #266
> **æ—¥æœŸ**: 2026-02-19
> **çŠ¶æ€**: å·²ç¡®è®¤ï¼Œå¾…å®æ–½

---

## èƒŒæ™¯

å½“å‰ @ æåŠåŠŸèƒ½çš„å®ç°å­˜åœ¨é—®é¢˜ï¼š
1. `@ä¸“å®¶å` æ˜¾ç¤ºåœ¨è¾“å…¥æ¡†å’Œæ¶ˆæ¯æ°”æ³¡ä¸­ï¼Œé€ æˆè§†è§‰å™ªéŸ³
2. å‰ç«¯ `parseMentionedAgents` å·²åšè§£æï¼Œä½† `@xxx` ä»éšæ¶ˆæ¯å‘é€
3. åç«¯è·¯ç”±ä¾èµ–å…³é”®è¯åŒ¹é…ï¼Œç”¨æˆ·æ˜ç¡®æŒ‡å®šçš„ä¸“å®¶ä¿¡æ¯æœªè¢«ä¼˜å…ˆä½¿ç”¨

## ç›®æ ‡

- UI å±‚ï¼š@ ä¸“å®¶æ˜¾ç¤ºä¸ºå¯ç§»é™¤çš„ã€Œæ ‡ç­¾/å¾½ç« ã€ï¼Œç‹¬ç«‹äºè¾“å…¥æ–‡æœ¬
- æ•°æ®å±‚ï¼šæ¶ˆæ¯å†…å®¹ä¸ç›®æ ‡ä¸“å®¶åˆ†ç¦»
- è·¯ç”±å±‚ï¼šåç«¯æ”¶åˆ°æ˜¾å¼ä¸“å®¶æ—¶è·³è¿‡è§„åˆ™åŒ¹é…ï¼Œç›´æ¥è·¯ç”±
- Handoff ä¿ç•™ï¼šä¸“å®¶æ‰§è¡Œæ—¶å‘ç°è¶…å‡ºèƒ½åŠ›ï¼Œä»å¯ handoff

---

## ç°æœ‰å®ç°åˆ†æ

### å‰ç«¯æµç¨‹

```
è¾“å…¥æ¡†: "@ç°ç° æŸ¥ç¬”è®°"
    â†“
parseMentionedAgents() â†’ { agents: ["memo"], cleanMessage: "æŸ¥ç¬”è®°" }
    â†“
handleParrotChat() â†’ å‘é€ message="@ç°ç° æŸ¥ç¬”è®°", agent_type=AUTO
    â†“
åç«¯è§£ææ¶ˆæ¯ä¸­çš„ @æåŠ
```

**é—®é¢˜**ï¼š`parseMentionedAgents` å­˜åœ¨ä½†æœªç”¨äºå‘é€æµç¨‹ï¼Œ`@ä¸“å®¶å` ä»è¢«å‘é€ã€‚

### åç«¯è·¯ç”±

```go
// ChatRouter.RouteWithContext è·¯ç”±ä¼˜å…ˆçº§
1. çŸ­ç¡®è®¤è¯ â†’ ç²˜æ€§è·¯ç”±
2. FastRouter (cache â†’ rule) â†’ è§„åˆ™åŒ¹é…
3. ç½®ä¿¡åº¦ < 0.8 â†’ Orchestrator
```

**é—®é¢˜**ï¼šæ— æ˜¾å¼ä¸“å®¶æŒ‡å®šä¼˜å…ˆçº§ï¼Œç”¨æˆ·æ˜ç¡®é€‰æ‹©è¢«å¿½ç•¥ã€‚

---

## æŠ€æœ¯æ–¹æ¡ˆ

### 1. å‰ç«¯ UI è®¾è®¡

**è¾“å…¥æ¡†å¸ƒå±€**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚  â”‚ ğŸª¶ ç°ç° Ã—â”‚  æŸ¥ç¬”è®°                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**çŠ¶æ€ç®¡ç†**ï¼š
```typescript
const [selectedAgent, setSelectedAgent] = useState<ParrotInfoFromAPI | null>(null);
```

### 2. å‰ç«¯ API è°ƒç”¨

```typescript
// handleSend ä¿®æ”¹
const targetParrotId = selectedAgent
  ? parrotAgentTypeFromString(selectedAgent.agentType)  // ç”¨æˆ·æ˜ç¡®æŒ‡å®š
  : capabilityToParrotAgent(currentCapability);         // è‡ªåŠ¨è·¯ç”±

// å‘é€åæ¸…é™¤
setSelectedAgent(null);
```

### 3. åç«¯è·¯ç”±ä¼˜åŒ–

```go
// è·¯ç”±ä¼˜å…ˆçº§ï¼ˆæ–°å¢ç¬¬ 1 çº§ï¼‰
1. æ˜¾å¼æŒ‡å®š â†’ ç›´æ¥è·¯ç”±ï¼Œç½®ä¿¡åº¦ 1.0
2. çŸ­ç¡®è®¤è¯ â†’ ç²˜æ€§è·¯ç”±
3. FastRouter â†’ è§„åˆ™åŒ¹é…
```

---

## æ–‡ä»¶æ”¹åŠ¨æ¸…å•

| æ–‡ä»¶ | æ”¹åŠ¨ç±»å‹ | è¯´æ˜ |
|:-----|:---------|:-----|
| `web/src/components/AIChat/ChatInput.tsx` | ä¿®æ”¹ | æ·»åŠ  `selectedAgent` çŠ¶æ€ |
| `web/src/components/AIChat/AgentBadge.tsx` | æ–°å¢ | ä¸“å®¶æ ‡ç­¾ç»„ä»¶ |
| `web/src/pages/AIChat.tsx` | ä¿®æ”¹ | ä¿®æ”¹ `handleSend` |
| `ai/agents/chat_router.go` | ä¿®æ”¹ | æ·»åŠ æ˜¾å¼è·¯ç”±ä¼˜å…ˆçº§ |
| `web/src/locales/*.json` | ä¿®æ”¹ | æ·»åŠ  i18n key |

---

## ç«å“å‚è€ƒ

| äº§å“ | å®ç°æ–¹å¼ | å€Ÿé‰´ç‚¹ |
|:-----|:---------|:-------|
| Slack | @ æåŠè½¬ä¸ºè“è‰²æ ‡ç­¾ï¼Œå¯åˆ é™¤ | æ ‡ç­¾å¼ UI |
| Notion AI | `/` å‘½ä»¤è½¬ä¸ºå‘½ä»¤å— | éšå¼ä¼ é€’ |
| Cursor | `@` è§¦å‘é€‰æ‹©å™¨ï¼Œä½œä¸ºå…ƒæ•°æ® | åˆ†ç¦»è®¾è®¡ |

---

## é£é™©è¯„ä¼°

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|:-----|:-----|:---------|
| æ¶ˆæ¯æ°”æ³¡æ˜¾ç¤ºä¸ä¸€è‡´ | ä¸­ | ä» Block.Metadata è¯»å–ä¸“å®¶ä¿¡æ¯ |
| ç”¨æˆ·å¿˜è®°é€‰æ‹©ä¸“å®¶ | ä½ | ä¿ç•™è‡ªåŠ¨è·¯ç”±ä½œä¸º fallback |
| å¤šè½®å¯¹è¯ä¸“å®¶åˆ‡æ¢ | ä½ | æ¯æ¡æ¶ˆæ¯ç‹¬ç«‹å­˜å‚¨ |

---

## å…ƒè®¤çŸ¥è¯„ä¼°

| ç»´åº¦ | è¯„åˆ† |
|:-----|:-----|
| æŠ€æœ¯å¯è¡Œæ€§ | 5/5 |
| ç”¨æˆ·ä»·å€¼ | 5/5 |
| ç«å“å‚è€ƒ | 4/5 |
| å®ç°å¤æ‚åº¦ | 5/5 |
| ä¾èµ–æ¸…æ™°åº¦ | 5/5 |
| **æ€»è¯„** | **4.8/5** |

---

## å‚è€ƒèµ„æ–™

- Issue #259: Agent Mention Popover åŸºç¡€å®ç°
- Issue #266: æœ¬æ¬¡ä¼˜åŒ–ç›®æ ‡
- `web/src/utils/agentMention.ts`: ç°æœ‰è§£æé€»è¾‘
- `ai/agents/chat_router.go`: ç°æœ‰è·¯ç”±é€»è¾‘
