# Warp Block é£æ ¼ç»Ÿä¸€èŠå¤©ç•Œé¢è°ƒç ”æŠ¥å‘Š

**è°ƒç ”æ—¥æœŸ**: 2026-02-04
**ç›¸å…³ Issue**: [#69](https://github.com/hrygo/divinesense/issues/69)
**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## 1. ç†è§£ä¸æ‰©å±•

### 1.1 æ ¸å¿ƒéœ€æ±‚

é‡‡ç”¨ Warp çš„ Block è®¾è®¡ç†å¿µï¼Œå°†æ¯ä¸ªç”¨æˆ·è¾“å…¥åŠå…¶ç›¸å…³çš„æ‰€æœ‰ AI æ´»åŠ¨ï¼ˆæ€è€ƒã€å·¥å…·è°ƒç”¨ã€å›ç­”ï¼‰å°è£…ä¸ºä¸€ä¸ªç»Ÿä¸€çš„ã€å¯æŠ˜å çš„ Blockï¼Œè§£å†³å½“å‰ UI å‰²è£‚é—®é¢˜ã€‚

### 1.2 éœ€æ±‚æ¾„æ¸…

| é¡¹ç›® | å†…å®¹ |
|:-----|:-----|
| **ç›®æ ‡ç”¨æˆ·** | Geek/Evolution Mode é‡åº¦ç”¨æˆ·ã€å¸¸è§„ AI èŠå¤©ç”¨æˆ· |
| **ä½¿ç”¨åœºæ™¯** | é•¿å¯¹è¯ã€å¤šå·¥å…·è°ƒç”¨ã€éœ€è¦å›æº¯å†å²è¾“å‡º |
| **æ ¸å¿ƒç—›ç‚¹** | å½“å‰ InlineToolCall/ToolResults/SessionSummary/GenerativeUI å„è‡ªä¸ºæ”¿ |

### 1.3 å·²æœ‰ç›¸å…³è°ƒç ”

- âœ… `event-type-ui-research.md` (2026-02-01) - å·²å®šä¹‰ EventBadge å’Œ ToolCallCard ç»„ä»¶
- âœ… `cc-runner-message-handling-research.md` (2026-02-03) - 69 ä¸ªæµ‹è¯•ç”¨ä¾‹è¦†ç›–å®Œæ•´æ¶ˆæ¯æµ

### 1.4 å¯èƒ½æ€§æ‰©å±•ï¼ˆæœªæ¥è¿­ä»£ï¼‰

- **Block å¯¼å‡º**ï¼šå•ä¸ª Block å¯åˆ†äº«/å¯¼å‡ºï¼ˆMarkdown æ ¼å¼ï¼‰
- **Block æœç´¢**ï¼šè·¨ Block æœç´¢å‘½ä»¤å’Œè¾“å‡º
- **Block å¯¼èˆª**ï¼šé”®ç›˜å¿«æ·é”®åœ¨ Block é—´è·³è½¬

---

## 2. æ·±åº¦è°ƒç ”

### 2.1 æŠ€æœ¯å¯è¡Œæ€§

**å¯è¡Œæ€§è¯„çº§**: âœ… **é«˜**

**ç°æœ‰åŸºç¡€**ï¼š
- `ConversationMessage.metadata` å·²åŒ…å« `toolCalls` å’Œ `toolResults`
- `EventBadge`, `ToolCallCard`, `TerminalOutput` ç»„ä»¶å·²å®ç°
- æµå¼äº‹ä»¶å¤„ç†æ¡†æ¶å®Œæ•´ï¼ˆ`onThinking`, `onToolUse`, `onToolResult`, `onSessionSummary`ï¼‰

**æ¶æ„å½±å“**: ğŸŸ¡ **å°æ”¹åŠ¨**ï¼ˆä¸»è¦æ˜¯å‰ç«¯é‡æ„ï¼‰

**æŠ€æœ¯æ–¹æ¡ˆ**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UnifiedMessageBlock (æ–°ç»„ä»¶)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Block Header (ç”¨æˆ·è¾“å…¥ + æ—¶é—´æˆ³ + çŠ¶æ€å¾½ç« )        â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ Block Body (å¯æŠ˜å å†…å®¹)                           â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Thinking Section (onThinking)                â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ ToolCalls Section (onToolUse + onToolResult) â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ Answer Section (onContent)                   â”‚ â”‚
â”‚  â”‚  â””â”€â”€ SessionSummary Section (onSessionSummary)    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Block Footer (æ“ä½œæ ï¼šæŠ˜å /å±•å¼€/å¤åˆ¶/åˆ é™¤)         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ç”¨æˆ·ä»·å€¼

**è§£å†³çš„é—®é¢˜**ï¼š
| ç—›ç‚¹ | å½“å‰çŠ¶æ€ | Warp Block æ–¹æ¡ˆ |
|:-----|:---------|:---------------|
| è§†è§‰å‰²è£‚ | 4 ä¸ªç‹¬ç«‹åŒºåŸŸ | 1 ä¸ªç»Ÿä¸€å®¹å™¨ |
| çŠ¶æ€è¿½è¸ª | éœ€è¦æ»šåŠ¨æŸ¥çœ‹ | Block Header ä¸€ç›®äº†ç„¶ |
| å¯¼èˆªå›°éš¾ | æ— è·³è·ƒæœºåˆ¶ | Block é—´å¿«é€Ÿå®šä½ |

**ç›®æ ‡ç”¨æˆ·**ï¼šæ‰€æœ‰ AI èŠå¤©ç”¨æˆ·ï¼ˆæ™®é€š + Geek + Evolutionï¼‰

**ä½¿ç”¨é¢‘ç‡**: **é«˜**ï¼ˆæ¯æ¬¡èŠå¤©éƒ½ä¼šæ¶‰åŠï¼‰

### 2.3 ç«å“/æœ€ä½³å®è·µ

| äº§å“ | å®ç°æ–¹å¼ | å¯å€Ÿé‰´ç‚¹ | å‚è€ƒé“¾æ¥ |
|:-----|:---------|:---------|:--------|
| **Warp** | è¾“å…¥+è¾“å‡ºåˆ†ç»„ä¸º Block | ä¸‰æ ¼ç»“æ„ã€å¯æŠ˜å ã€å¯å¯¼èˆª | [Blocks Behavior](https://docs.warp.dev/terminal/appearance/blocks-behavior) |
| **Cursor AI** | å³ä¾§é¢æ¿å®æ—¶å±•ç¤º | å†…è”å·¥å…·è°ƒç”¨ã€çŠ¶æ€åŠ¨ç”» | [Cursor Blog](https://cursor.sh/blog) |
| **GitHub Copilot Workspace** | æ—¶é—´çº¿å¼å±•ç¤º | å¤šæ­¥éª¤å¯è§†åŒ– | [Copilot Workspace](https://github.com/features/copilot) |

### 2.4 å®ç°å¤æ‚åº¦

**å·¥ä½œé‡ä¼°ç®—**: **2-3 äººå‘¨**

**é£é™©ç‚¹**ï¼š
- ğŸŸ¡ æµå¼æ›´æ–°æ—¶çš„é‡æ¸²æŸ“æ€§èƒ½ï¼ˆå¯ä½¿ç”¨ `useDeferredValue` ä¼˜åŒ–ï¼‰
- ğŸŸ¢ åµŒå¥— Block çš„å¤„ç†ï¼ˆGeek Mode å·¥å…·è°ƒç”¨å¯èƒ½åµŒå¥—ï¼‰
- ğŸŸ¢ ç§»åŠ¨ç«¯å“åº”å¼é€‚é…ï¼ˆTailwind å·²æœ‰æ–­ç‚¹ç³»ç»Ÿï¼‰

**ä¾èµ–é¡¹**ï¼š
- æ— é˜»å¡ä¾èµ–
- å¯ä¸ç°æœ‰ `ConversationMessage` ç»“æ„å…¼å®¹

### 2.5 ç›¸å…³ Issue

- âœ… å·²åˆ›å»º [#69](https://github.com/hrygo/divinesense/issues/69)

---

## 3. æ–¹æ¡ˆè®¾è®¡

### 3.1 åŠŸèƒ½è¾¹ç•Œ

**åŒ…å«**ï¼š
- âœ… æ¯ä¸ªç”¨æˆ·æ¶ˆæ¯ + AI å›å¤ = 1 ä¸ª UnifiedMessageBlock
- âœ… æ–° Block é»˜è®¤å±•å¼€ï¼Œå†å² Block é»˜è®¤æŠ˜å 
- âœ… é€‚é…ç°æœ‰ Parrot ä¸»é¢˜ï¼ˆç»¿è‰²/ç´«è‰²/è“è‰²ä¸‰ç§ä¸»é¢˜è‰²ï¼‰
- âœ… ä¿ç•™æŠ˜å /å±•å¼€/å¤åˆ¶/åˆ é™¤äº¤äº’

**ä¸åŒ…å«**ï¼ˆæœªæ¥è¿­ä»£ï¼‰ï¼š
- âŒ Block å¯¼å‡º/åˆ†äº«åŠŸèƒ½
- âŒ Block çº§åˆ«çš„æœç´¢/å¯¼èˆª

### 3.2 æŠ€æœ¯æ–¹æ¡ˆ

**å‰ç«¯ç»„ä»¶**ï¼š
```
web/src/components/AIChat/
â”œâ”€â”€ UnifiedMessageBlock.tsx        # ä¸»å®¹å™¨ç»„ä»¶
â”œâ”€â”€ BlockHeader.tsx                # å¤´éƒ¨ï¼šç”¨æˆ·æ¶ˆæ¯ + çŠ¶æ€
â”œâ”€â”€ BlockCollapsibleBody.tsx       # ä¸»ä½“ï¼šå¯æŠ˜å å†…å®¹åŒº
â”‚   â”œâ”€â”€ ThinkingSection.tsx        # æ€è€ƒè¿‡ç¨‹ï¼ˆå¯é€‰æ˜¾ç¤ºï¼‰
â”‚   â”œâ”€â”€ ToolCallsSection.tsx       # å·¥å…·è°ƒç”¨åˆ—è¡¨
â”‚   â”œâ”€â”€ AnswerSection.tsx          # æœ€ç»ˆå›ç­”
â”‚   â””â”€â”€ SummarySection.tsx         # ä¼šè¯ç»Ÿè®¡ï¼ˆGeek/Evolutionï¼‰
â””â”€â”€ BlockActions.tsx               # æ“ä½œæ 
```

**çŠ¶æ€ç®¡ç†**ï¼š
```typescript
// æ‰©å±• ConversationMessage
interface ConversationMessage {
  // ... ç°æœ‰å­—æ®µ
  blockState?: {
    collapsed: boolean;  // æ˜¯å¦æŠ˜å 
    active: boolean;     // æ˜¯å¦æ˜¯å½“å‰æ´»è·ƒ Block
  };
}
```

### 3.3 æŠ˜å ç­–ç•¥

| Block ç±»å‹ | é»˜è®¤çŠ¶æ€ | è¯´æ˜ |
|:----------|:--------|:-----|
| æ–°åˆ›å»ºï¼ˆæµå¼ä¸­ï¼‰ | ğŸ“‚ å±•å¼€ | ç”¨æˆ·éœ€è¦çœ‹åˆ°å®æ—¶æ›´æ–° |
| å·²å®Œæˆï¼ˆæœ€æ–°ï¼‰ | ğŸ“‚ å±•å¼€ | ç”¨æˆ·åˆšçœ‹å®Œï¼Œä¿æŒå±•å¼€ |
| å†å²ï¼ˆéæœ€æ–°ï¼‰ | ğŸ“ æŠ˜å  | èŠ‚çœå‚ç›´ç©ºé—´ |

### 3.4 Parrot ä¸»é¢˜é€‚é…

| æ¨¡å¼ | Block è¾¹æ¡† | Header èƒŒæ™¯ | çŠ¶æ€æŒ‡ç¤º |
|:-----|:----------|:-----------|:--------|
| Normal | `border-zinc-200/300` | ç™½è‰²/æµ…ç° | ç°è‰²å¾½ç«  |
| Geek | `border-green-500/30` | ç»¿è‰²åŠé€æ˜ | ç»¿è‰²å¾½ç«  |
| Evolution | `border-purple-500/30` | ç´«è‰²åŠé€æ˜ | ç´«è‰²å¾½ç«  |

---

## 4. é£é™©ä¸ç¼“è§£

| é£é™© | å½±å“ | ç¼“è§£æªæ–½ |
|:-----|:-----|:---------|
| æµå¼æ›´æ–°æ€§èƒ½ | ä¸­ | ä½¿ç”¨ `useDeferredValue` å»¶è¿Ÿéå…³é”®æ¸²æŸ“ |
| å¤§é‡ Block å†…å­˜å ç”¨ | ä½ | ç°æœ‰ FIFO ç¼“å­˜ï¼ˆ100 æ¡æ¶ˆæ¯ï¼‰å·²é™åˆ¶ |
| æŠ˜å çŠ¶æ€åŒæ­¥ | ä¸­ | ä½¿ç”¨ Map æŒ‰ messageId å­˜å‚¨çŠ¶æ€ |

---

## 5. éªŒæ”¶æ ‡å‡†

- [x] Issue åˆ›å»º (#69)
- [ ] `make check-all` é€šè¿‡
- [ ] æ–°å»º `UnifiedMessageBlock` ç»„ä»¶
- [ ] æ”¯æŒä¸‰ç§ Parrot ä¸»é¢˜é€‚é…
- [ ] æ–° Block é»˜è®¤å±•å¼€ï¼Œå†å² Block é»˜è®¤æŠ˜å 
- [ ] ä¿ç•™æ‰€æœ‰ç°æœ‰äº¤äº’åŠŸèƒ½
- [ ] æ›´æ–° `docs/dev-guides/FRONTEND.md`

---

## 6. å‚è€ƒé“¾æ¥

- [Issue #69](https://github.com/hrygo/divinesense/issues/69)
- [Warp Blocks Behavior](https://docs.warp.dev/terminal/appearance/blocks-behavior)
- [Warp æ•°æ®ç»“æ„è§£æ](https://www.warp.dev/blog/the-data-structure-behind-terminals)
- [event-type-ui-research.md](./event-type-ui-research.md)
- [cc-runner-message-handling-research.md](./cc-runner-message-handling-research.md)

---

**è°ƒç ”ç”Ÿæˆæ—¶é—´**: 2026-02-04
**è°ƒç ”ç‰ˆæœ¬**: v1.0
