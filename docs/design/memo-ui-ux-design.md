# Memo UI/UX 渐进式改进方案

> **设计原则**: 尊重现有基础 · 渐进式增强 · 务实迭代
>
> **目标**: 功能完整化 + 体验提升，而非激进重构

---

## 1. 现有设计基础

### 1.1 已有优势（保持不变）

| 组件 | 状态 | 说明 |
|:-----|:-----|:-----|
| **色彩系统** | ✅ 完善 | OKLCH + 6 色便签 (tag-colors.ts) |
| **亮/暗主题** | ✅ 完善 | default.css + default-dark.css |
| **MemoBlockV3** | ✅ 完善 | 便签设计 + 手势操作 + 全屏模式 |
| **MemoEditor** | ✅ 完善 | 斜杠命令 + 标签建议 |
| **响应式** | ✅ 完善 | 移动端适配 |
| **动画** | ✅ 基础完善 | Tailwind 动画类 |

---

## 2. P0: 空状态设计

### 2.1 首次使用引导

**触发条件**: 用户没有任何 Memo 时显示

```
┌─────────────────────────────────────────────────────────┐
│                                                         │
│         ✨ 开始记录你的想法                             │
│                                                         │
│    神识是你的第二大脑，帮助你整理思绪                    │
│                                                         │
│    💡 试试在下方输入第一条笔记                          │
│                                                         │
│    示例:                                                │
│    · 今天学到了...                                     │
│    · #想法 灵感记录...                                 │
│    · 待办事项清单...                                   │
│                                                         │
└─────────────────────────────────────────────────────────────┘
```

**设计要点**:
- 淡雅插画风格，不抢眼
- 使用 `text-muted-foreground` 配色
- 居中显示在 Memo 列表区域

**实现位置**: `MemoListV3.tsx` 空状态判断

### 2.2 搜索无结果

**触发条件**: 搜索结果为空时显示

```
┌─────────────────────────────────────────────────────────┐
│                                                         │
│         🔍 没有找到相关内容                              │
│                                                         │
│    搜索: "关键词"                                       │
│                                                         │
│    建议:                                                │
│    · 尝试不同的关键词                                   │
│    · 检查拼写是否正确                                   │
│    · 使用更通用的搜索词                                 │
│                                                         │
│              [清除搜索]                                 │
│                                                         │
└─────────────────────────────────────────────────────────────┘
```

**设计要点**:
- 显示用户搜索的关键词
- 提供建设性建议
- 清除搜索按钮快速重置

**实现位置**: `MemoListV3.tsx` / 搜索相关组件

### 2.3 归档为空

**触发条件**: 归档页面没有任何内容时显示

```
┌─────────────────────────────────────────────────────────┐
│                                                         │
│         📦 归档是空的                                   │
│                                                         │
│    左滑 Memo 可以将其归档                               │
│                                                         │
└─────────────────────────────────────────────────────────────┘
```

**设计要点**:
- 简洁明了
- 提示用户如何归档操作

**实现位置**: `Archived.tsx` 页面

---

## 3. P1: 移动端体验优化

### 3.1 全屏阅读模式退出

**现状**: 全屏模式下移动端退出方式不明显

**改进方案**:

```
┌───────────────────────┐
│   全屏阅读模式        │
├───────────────────────┤
│  ┌─────────────────┐  │
│  │ 用户名 · 2h     │  │  ← 顶部栏
│  │ ─────────────── │  │
│  │                 │  │
│  │   Memo 内容     │  │
│  │   ...          │  │
│  │                 │  │
│  └─────────────────┘  │
│                       │
│  ┌─────────────────┐  │
│  │  ↓ 下滑退出     │  │  ← 底部提示 (渐隐)
│  └─────────────────┘  │
│                       │
└───────────────────────┘
```

**实施内容**:
1. ✅ 下滑退出手势 - 从顶部下滑退出全屏 (iOS 风格)
2. ✅ 底部提示文字 - 显示"↓ 下滑退出"，2秒后渐隐

**实现要点**:
```typescript
// 添加下拉手势检测
const [pullDistance, setPullDistance] = useState(0);
const PULL_THRESHOLD = 100; // 下拉 100px 触发退出

const handleTouchMove = (e: TouchEvent) => {
  if (isReadingMode && scrollTop === 0) {
    const distance = e.touches[0].clientY - touchStartY;
    if (distance > 0) {
      setPullDistance(distance);
    }
  }
};

const handleTouchEnd = () => {
  if (pullDistance > PULL_THRESHOLD) {
    toggleFullscreen(); // 退出全屏
  }
  setPullDistance(0);
};
```

**实现位置**: `MemoBlockV3.tsx`

### 3.2 固定编辑器键盘适配

**现状**: 底部编辑器在移动端键盘弹出时可能被遮挡

**改进方案**:

```
┌───────────────────────┐
│      正常状态          │
├───────────────────────┤
│  ┌─────────────────┐  │
│  │   Memo 列表     │  │
│  │                 │  │
│  └─────────────────┘  │
│  ┌─────────────────┐  │
│  │ 有什么想法... │  │  ← 收起状态
│  └─────────────────┘  │
└───────────────────────┘

         ↓ 键盘弹出

┌───────────────────────┐
│      编辑模式          │
├───────────────────────┤
│  ┌─────────────────┐  │
│  │   编辑区域      │  │  ← 自动上移
│  │   ...          │  │
│  └─────────────────┘  │
│  ┌─────────────────┐  │
│  │ #标签  128字 [→]│  │  ← 操作栏在键盘上方
│  └─────────────────┘  │
│  [  键盘区域  ]       │
└───────────────────────┘
```

**实现要点**:
- 使用 `visualViewport` API 检测键盘高度
- 键盘弹出时，编辑器容器 `bottom` 值动态调整
- 保证输入框始终可见

```typescript
// VisualViewport 适配
useEffect(() => {
  if (typeof visualViewport === 'undefined') return;

  const handleResize = () => {
    const offset = window.innerHeight - visualViewport.height;
    setKeyboardOffset(offset);
  };

  visualViewport.addEventListener('resize', handleResize);
  return () => visualViewport.removeEventListener('resize', handleResize);
}, []);
```

**实现位置**: `FixedEditor.tsx`

### 3.3 手势反馈增强

**现状**: 滑动手势已有，但反馈不够明显

**改进方案**:
```
┌───────────────────────┐
│  左滑/右滑时:          │
│  ┌─────────────────┐  │
│  │    卡片倾斜      │  │  ← 滑动时产生倾斜效果
│  └─────────────────┘  │
└───────────────────────┘
```

**实施内容**:
- ✅ 卡片倾斜动画 - 滑动时卡片产生轻微倾斜效果

**实现要点**:
```typescript
// 根据滑动距离计算倾斜角度
const tiltAngle = Math.min(swipeDistance * 0.05, 5); // 最大倾斜 5 度
const tiltDirection = swipeDirection === 'left' ? -1 : 1;

// 应用 transform
style={{
  transform: `translateX(${swipeDistance}px) rotate(${tiltAngle * tiltDirection}deg)`,
  transition: swipeDistance === 0 ? 'transform 200ms ease' : 'none',
}}
```

**实现位置**: `MemoBlockV3.tsx`

---

## 4. P1: PC 端体验优化

### 4.1 列表键盘导航

**功能描述**:
- `↑↓` 在 Memo 列表中上下移动选中
- `Enter` 进入详情页
- 当前选中 Memo 添加左侧边框指示

```
┌─────────────────────────────────────────────────────────┐
│                    键盘导航                              │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │ Memo 1                                          │   │
│  └─────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────┐   │
│  │▌Memo 2 (选中)      ← 蓝色左边框指示            │   │
│  └─────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────┐   │
│  │ Memo 3                                          │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  操作: ↑↓ 移动 | Enter 详情 | Escape 取消选中          │
│                                                         │
└─────────────────────────────────────────────────────────────┘
```

**实现要点**:
```typescript
// 键盘事件处理
const handleKeyDown = (e: KeyboardEvent) => {
  switch (e.key) {
    case 'ArrowDown':
      e.preventDefault();
      setSelectedIndex(prev => Math.min(prev + 1, memos.length - 1));
      break;
    case 'ArrowUp':
      e.preventDefault();
      setSelectedIndex(prev => Math.max(prev - 1, 0));
      break;
    case 'Enter':
      if (selectedMemo) {
        navigateTo(`/${selectedMemo.name}`);
      }
      break;
    case 'Escape':
      setSelectedIndex(-1);
      break;
  }
};
```

**实现位置**: `MemoListV3.tsx`

---

## 5. P2: 动效优化

### 5.1 任务完成动画

**功能描述**: 点击任务 checkbox 时，添加 scale 脉冲动画

```css
/* 任务完成动画 */
.memo-task:checked + label {
  animation: taskComplete 300ms ease;
}

@keyframes taskComplete {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.2); }
}
```

**实现位置**: `MemoView/MemoBody.tsx` 或全局 CSS

### 5.2 保存成功动画

**功能描述**: Memo 保存成功时，卡片添加脉冲高亮效果

```css
/* 保存成功脉冲 */
.memo-saved {
  animation: savePulse 300ms ease;
}

@keyframes savePulse {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.7;
    box-shadow: 0 0 0 4px oklch(0.6 0.08 250 / 0.3);
  }
}
```

**触发时机**: Memo 创建/更新成功后，给对应的 MemoBlock 添加 `.memo-saved` 类

**实现位置**: `MemoBlockV3.tsx` + 全局 CSS

### 5.3 骨架屏优化

**功能描述**: 加载时使用便签对应颜色的骨架屏

```
┌─────────────────────────────────────────────────────────┐
│                    骨架屏设计                            │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │  ┌──┐ ████████████████                          │   │
│  │  │  │ ████                                        │   │
│  │  └──┘                                             │   │
│  │  ═════════════════════════════════════════════   │   │
│  │  ████████████████████████████████████████       │   │
│  │                                                   │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  设计要点:                                              │
│  - 使用便签对应的背景色 (amber-50/rose-50 等)          │
│  - 骨架条使用 `bg-current/10` 保持一致性               │
│  - shimmer 动画 1.5s 循环                              │
│                                                         │
└─────────────────────────────────────────────────────────────┘
```

**实现要点**:
```tsx
// 骨架屏组件
const MemoSkeleton = ({ colorKey = 'amber' }: { colorKey?: StickyColorKey }) => {
  const colorClasses = getMemoColorClasses([colorKey]);

  return (
    <div className={cn(
      "rounded-lg overflow-hidden animate-pulse",
      colorClasses.bg,
      colorClasses.border,
      "border"
    )}>
      <div className="p-4 space-y-3">
        <div className="flex items-center gap-3">
          <div className="w-9 h-9 rounded-full bg-current/10" />
          <div className="flex-1 space-y-2">
            <div className="h-3 bg-current/10 rounded w-2/3" />
            <div className="h-2 bg-current/10 rounded w-1/3" />
          </div>
        </div>
        <div className="space-y-2">
          <div className="h-2 bg-current/10 rounded" />
          <div className="h-2 bg-current/10 rounded w-4/5" />
        </div>
      </div>
    </div>
  );
};
```

**实现位置**: 新建 `components/Memo/MemoSkeleton.tsx`

---

## 6. 不改动的部分

以下内容**保持现状**，不进行修改：

| 组件 | 原因 |
|:-----|:-----|
| 色彩系统 | OKLCH + 6 色便签已完善 |
| 亮/暗主题 | 已完善，无需改动 |
| MemoBlockV3 架构 | 架构合理，仅需微调 |
| 手势检测逻辑 | 已实现，仅需增强反馈 |
| 后端 API | 完全不动 |
| 快捷键 | 不新增 |
| 侧边栏 | 不改动 |
| 悬停预览 | 不实施 |
| 网络断开/保存失败/加载失败提示 | 不实施 |
| 无障碍支持 | 不实施 |

---

## 7. 实施计划

### Phase 1: 空状态 (2-3 天)

| 任务 | 优先级 | 工作量 |
|:-----|:-------|:-------|
| 首次使用引导组件 | P0 | 1 天 |
| 搜索无结果组件 | P0 | 0.5 天 |
| 归档为空组件 | P0 | 0.5 天 |

### Phase 2: 移动端优化 (2-3 天)

| 任务 | 优先级 | 工作量 |
|:-----|:-------|:-------|
| 全屏下滑退出 + 底部提示 | P1 | 1 天 |
| 固定编辑器键盘适配 | P1 | 1 天 |
| 手势卡片倾斜动画 | P1 | 0.5 天 |

### Phase 3: PC 端优化 (1-2 天)

| 任务 | 优先级 | 工作量 |
|:-----|:-------|:-------|
| 列表键盘导航 | P1 | 1-2 天 |

### Phase 4: 动效打磨 (1 天)

| 任务 | 优先级 | 工作量 |
|:-----|:-------|:-------|
| 任务完成动画 | P2 | 0.5 天 |
| 保存成功动画 | P2 | 0.5 天 |
| 骨架屏优化 | P2 | 0.5 天 |

---

## 8. 验收标准

### 功能验收

- [ ] 首次使用显示欢迎引导
- [ ] 搜索无结果显示建议和清除按钮
- [ ] 归档为空显示提示
- [ ] 全屏模式支持下滑退出 + 底部提示
- [ ] 键盘弹出时编辑器正确适配
- [ ] 滑动时卡片有倾斜效果
- [ ] `↑↓` 键可导航 Memo 列表
- [ ] 任务完成有脉冲动画
- [ ] 保存成功有高亮效果
- [ ] 加载时显示便签色骨架屏

### 兼容性验收

- [ ] Chrome/Firefox/Safari 最新版
- [ ] iOS Safari / Android Chrome
- [ ] 暗色模式显示正确

---

## 9. 实施清单汇总

| 编号 | 功能 | 状态 |
|:-----|:-----|:-----|
| P0-4 | 首次使用引导 | ✅ 实施 |
| P0-5 | 搜索无结果提示 | ✅ 实施 |
| P0-6 | 归档为空提示 | ✅ 实施 |
| P1-1 | 全屏退出 (下滑手势 + 底部提示) | ✅ 实施 |
| P1-2 | 固定编辑器键盘适配 | ✅ 实施 |
| P1-3 | 手势反馈 (卡片倾斜动画) | ✅ 实施 |
| P1-5 | 列表键盘导航 | ✅ 实施 |
| P2-1 | 任务完成动画 | ✅ 实施 |
| P2-2 | 保存成功动画 | ✅ 实施 |
| P2-3 | 骨架屏优化 | ✅ 实施 |

**共 10 项功能，预计 6-8 天完成**

---

*本文档基于现有设计系统，采用渐进式改进策略。*
