# P1-05: LRUCache å®ç°ç»Ÿä¸€

> **é˜¶æ®µ**: Phase 1 â€” æ¸…ç†æ¡¥æ¥å±‚ & DRY æ²»ç†  
> **åŸåˆ™**: DRY  
> **é£é™©**: ğŸŸ¡ ä¸­  
> **é¢„è®¡å·¥ä½œé‡**: 1 å¤©  
> **å‰ç½®ä¾èµ–**: æ— 

## èƒŒæ™¯

LRU ç¼“å­˜é€»è¾‘åœ¨ä¸‰å¤„ç‹¬ç«‹å®ç°ï¼Œå‡åŸºäº `container/list` + `sync.Mutex` + TTL è¿‡æœŸï¼š

| ä½ç½®                                        | è¡Œæ•°    | ç”¨é€”          |
| :------------------------------------------ | :------ | :------------ |
| `agents/universal/universal_parrot.go` å†…åµŒ | ~150 è¡Œ | ä»£ç†ç»“æœç¼“å­˜  |
| `routing/cache.go`                          | ~180 è¡Œ | è·¯ç”±å†³ç­–ç¼“å­˜  |
| `cache/lru.go`                              | ~130 è¡Œ | é€šç”¨ LRU ç¼“å­˜ |

## ç›®æ ‡

ç»Ÿä¸€åˆ° `ai/cache` åŒ…ä¸­çš„æ³›å‹ LRU å®ç°ï¼Œå…¶ä»–ä½ç½®å¼•ç”¨æ­¤åŒ…ã€‚

## æ¶‰åŠæ–‡ä»¶

| æ“ä½œ   | æ–‡ä»¶                                                                        |
| :----- | :-------------------------------------------------------------------------- |
| MODIFY | `ai/cache/lru.go`ï¼ˆç¡®ä¿æ”¯æŒæ³›å‹ / TTL / å¹¶å‘å®‰å…¨ï¼‰                          |
| MODIFY | `ai/agents/universal/universal_parrot.go`ï¼ˆåˆ é™¤å†…åµŒ LRUï¼Œæ”¹ç”¨ `cache.LRU`ï¼‰ |
| MODIFY | `ai/routing/cache.go`ï¼ˆåˆ é™¤è‡ªå®šä¹‰ LRUï¼Œæ”¹ç”¨ `cache.LRU`ï¼‰                   |

## æ”¹é€ æ­¥éª¤

1. **å®¡è®¡** ä¸‰å¤„ LRU å®ç°çš„åŠŸèƒ½å·®å¼‚ï¼ˆå®¹é‡ä¸Šé™ã€TTL ç­–ç•¥ã€å›è°ƒé’©å­ç­‰ï¼‰
2. **å¢å¼º** `cache/lru.go`ï¼Œç¡®ä¿è¦†ç›–æ‰€æœ‰ä¸‰å¤„çš„åŠŸèƒ½éœ€æ±‚ï¼š
   - æ³›å‹ç±»å‹å‚æ•°ï¼ˆGo 1.18+ï¼‰
   - å¯é€‰ TTL è¿‡æœŸ
   - å¹¶å‘å®‰å…¨ï¼ˆ`sync.RWMutex`ï¼‰
   - å¯é€‰å®¹é‡ä¸Šé™ä¸æ·˜æ±°å›è°ƒ
3. **æ›¿æ¢** `universal_parrot.go` ä¸­çš„å†…åµŒç¼“å­˜ä¸º `cache.NewLRU[string, *Result](...)`
4. **æ›¿æ¢** `routing/cache.go` ä¸­çš„è‡ªå®šä¹‰ç¼“å­˜ä¸º `cache.NewLRU[string, *CacheEntry](...)`
5. **é€æ­¥éªŒè¯**æ¯ä¸ªæ›¿æ¢ç‚¹

## éªŒæ”¶æ¡ä»¶

- [ ] `agents/universal/universal_parrot.go` ä¸å†åŒ…å« LRU ç›¸å…³çš„ `container/list` å¯¼å…¥
- [ ] `routing/cache.go` ä¸å†åŒ…å«ç‹¬ç«‹çš„ LRU ç»“æ„ä½“å®šä¹‰
- [ ] æ‰€æœ‰ LRU ä½¿ç”¨å‡æŒ‡å‘ `ai/cache` åŒ…
- [ ] `go build ./...` ç¼–è¯‘é€šè¿‡
- [ ] `go test ./ai/agents/universal/... -count=1` å…¨éƒ¨é€šè¿‡
- [ ] `go test ./ai/routing/... -count=1` å…¨éƒ¨é€šè¿‡
- [ ] `go test ./ai/cache/... -count=1` å…¨éƒ¨é€šè¿‡

## æ³¨æ„äº‹é¡¹

- ä¸‰å¤„å®ç°å¯èƒ½å­˜åœ¨ç»†å¾®å·®å¼‚ï¼ˆå¦‚ routing çš„ TTL å¯èƒ½åŸºäº hit-countï¼‰ï¼Œéœ€é€ä¸€æ’æŸ¥
- å»ºè®®å…ˆä¸º `cache/lru.go` ç¼–å†™å®Œæ•´æµ‹è¯•ç”¨ä¾‹å†æ›¿æ¢æ¶ˆè´¹æ–¹
