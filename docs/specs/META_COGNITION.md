# 元认知系统 (Meta-Cognition)

> DivineSense 对自身知识状态、检索质量、代理决策的监控与反思机制

---

## 概述

元认知系统是 DivineSense AI 代理的核心能力之一，使代理能够：

1. **知识状态感知** — 知道自己知道什么、不知道什么
2. **检索质量评估** — 评估搜索结果的相关性与完整性
3. **决策透明化** — 记录并解释每一步推理过程
4. **自我修正** — 识别错误并主动纠正

---

## 🧠 架构设计

```
用户查询
    │
    ▼
┌───────────────────┐
│   意图分析层       │ ← 理解用户真正需要什么
└─────────┬─────────┘
          │
          ▼
┌───────────────────┐
│   知识检索层       │ ← 搜索相关信息
└─────────┬─────────┘
          │
          ▼
┌───────────────────┐
│   元认知评估层     │ ← "信息够吗？准确吗？"
└─────────┬─────────┘
          │
    ┌─────┴─────┐
    │           │
    ▼           ▼
 充足 ───▶ 生成响应
 不足 ───▶ 补充检索 / 请求澄清
```

---

## 📊 评估维度

### 1. 信息完整度

| 等级   | 描述                 | 行动         |
| :----- | :------------------- | :----------- |
| **高** | 信息充足，可直接回答 | 生成响应     |
| **中** | 部分信息缺失         | 补充检索     |
| **低** | 关键信息缺失         | 请求用户澄清 |

### 2. 相关性评分

- **语义相似度**: 向量距离
- **关键词匹配度**: BM25 分数
- **上下文契合度**: 对话历史关联

### 3. 置信度标注

每个响应附带置信度指示：
- `[确定]` — 基于明确的知识库记录
- `[推测]` — 基于相关信息推理
- `[不确定]` — 需要用户确认

---

## 🔧 实现机制

### 检索质量监控

```go
type RetrievalQuality struct {
    TotalResults     int       // 总结果数
    RelevantCount    int       // 相关结果数
    TopScores        []float64 // 前 N 个分数
    CoverageRate     float64   // 查询覆盖率
}
```

### 决策日志

每个代理决策记录：

```json
{
  "timestamp": "2026-01-31T10:00:00Z",
  "agent": "amazing_parrot",
  "query": "用户查询",
  "intent": "识别的意图",
  "tools_used": ["memo_search", "schedule_query"],
  "reasoning": "推理过程描述",
  "confidence": 0.85
}
```

---

## 📈 度量指标

| 指标           | 描述              | 目标值 |
| :------------- | :---------------- | :----- |
| **检索准确率** | 相关结果 / 总结果 | > 80%  |
| **响应满意度** | 用户正向反馈率    | > 90%  |
| **澄清请求率** | 需要追问的比例    | < 15%  |
| **自我纠正率** | 主动修正错误比例  | > 95%  |

---

## 🔗 相关文档

- [AI 代理架构](../dev-guides/ARCHITECTURE.md#ai-代理架构)
- [RAG 检索系统](../research/00-master-roadmap.md)
- [调试经验](../research/DEBUG_LESSONS.md)

---

> 更新于 2026-01-31
