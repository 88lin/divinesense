import{r as e,j as t,X as s,aF as r,bw as a,$ as o,aG as i,aa as d,bx as n,Y as l}from"./react-vendor-LyyF-653.js";import{i as m,d as c,j as u,k as x,l as h,m as f,h as p,U as g,n as b,o as v,t as j,p as N,q as y,F as w,r as k,w as E,E as C,x as T}from"./index-D99LTaa7.js";import{w as U}from"./lodash-vendor-DIRPa7cU.js";import"./ui-vendor-ByoYm48K.js";import"./leaflet-vendor-Cu4zZue4.js";import"./markdown-vendor-DtAGkuPo.js";import"./math-vendor-JUchi9-2.js";import"./mermaid-vendor-B1M2OtO5.js";import"./polyfills-RlNY0w59.js";import"./i18n-vendor-Cyfgqt0p.js";function A({notification:d}){const n=m(),l=c(),[k,E]=e.useState(void 0),[C,T]=e.useState(void 0),[U,A]=e.useState(void 0),[D,M]=e.useState(!1),[S,R]=e.useState(!1),{data:I}=u(U||"",{enabled:!!U});var W,$;W=async()=>{if(d.activityId)try{const e=await x.getActivity({name:`${h}${d.activityId}`});if("memoComment"===e.payload?.payload?.case){const t=e.payload.payload.value,s=await f.getMemo({name:t.relatedMemo});E(s);const r=await f.getMemo({name:t.memo});T(r),A(d.sender),M(!0)}}catch(e){return void p(e,()=>{},{context:"Failed to fetch activity",onError:()=>R(!0)})}},$=[d.activityId],e.useEffect(()=>{W()},$);const F=async(e=!1)=>{await N.updateUserNotification({notification:{name:d.name,status:g.ARCHIVED},updateMask:y(w,{paths:["status"]})}),e||i.success(n("message.archived-successfully"))},H=async()=>{await N.deleteUserNotification({name:d.name}),i.success(n("message.deleted-successfully"))};if(!D&&!S)return t.jsx("div",{className:"w-full px-5 py-4 border-b border-border/60 last:border-b-0 bg-muted/10 animate-pulse",children:t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-muted/50 shrink-0"}),t.jsxs("div",{className:"flex-1 space-y-3",children:[t.jsx("div",{className:"h-4 bg-muted/50 rounded-md w-2/5"}),t.jsx("div",{className:"h-3 bg-muted/40 rounded-md w-3/4"}),t.jsx("div",{className:"h-20 bg-muted/30 rounded-xl"})]})]})});if(S)return t.jsx("div",{className:"w-full px-5 py-4 border-b border-border/60 last:border-b-0 bg-destructive/[0.04] group",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-full bg-destructive/15 flex items-center justify-center shrink-0 ring-1 ring-destructive/20",children:t.jsx(s,{className:"w-5 h-5 text-destructive",strokeWidth:2})}),t.jsx("span",{className:"text-sm text-destructive/80 font-medium",children:n("inbox.failed-to-load")})]}),t.jsx("button",{onClick:H,className:"p-1.5 hover:bg-destructive/15 rounded-lg transition-all duration-150 opacity-0 group-hover:opacity-100",title:n("common.delete"),children:t.jsx(r,{className:"w-4 h-4 text-destructive/70 hover:text-destructive transition-colors",strokeWidth:2})})]})});const O=d.status===g.UNREAD;return t.jsxs("div",{className:b("w-full px-5 py-4 border-b border-border/60 last:border-b-0 transition-all duration-200 group relative",O?"bg-primary/[0.03] hover:bg-primary/[0.05]":"hover:bg-muted/30"),children:[O&&t.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-0.5 bg-gradient-to-b from-primary to-primary/60"}),t.jsxs("div",{className:"flex items-start gap-3",children:[t.jsxs("div",{className:"relative shrink-0",children:[t.jsx(v,{className:"w-10 h-10 ring-1 ring-border/40",avatarUrl:I?.avatarUrl}),t.jsx("div",{className:b("absolute -bottom-1 -right-1 w-5 h-5 rounded-full border-2 border-background flex items-center justify-center shadow-md transition-all",O?"bg-primary text-primary-foreground":"bg-muted/80 text-muted-foreground"),children:t.jsx(a,{className:"w-2.5 h-2.5",strokeWidth:2.5})})]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center justify-between gap-3 mb-1",children:[t.jsxs("div",{className:"flex items-center gap-1.5 flex-wrap min-w-0",children:[t.jsx("span",{className:"font-semibold text-sm text-foreground/95",children:I?.displayName||I?.username}),t.jsx("span",{className:"text-sm text-muted-foreground/80",children:"commented on your memo"}),t.jsxs("span",{className:"text-xs text-muted-foreground/60",children:[d.createTime&&j(d.createTime)?.toLocaleDateString([],{month:"short",day:"numeric"})," ","at"," ",d.createTime&&j(d.createTime)?.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),t.jsx("div",{className:"flex items-center gap-1 shrink-0",children:O?t.jsx("button",{onClick:()=>F(),className:"p-1.5 hover:bg-primary/10 rounded-lg transition-all duration-150 opacity-0 group-hover:opacity-100",title:n("common.archive"),children:t.jsx(o,{className:"w-4 h-4 text-muted-foreground hover:text-primary transition-colors",strokeWidth:2})}):t.jsx("button",{onClick:H,className:"p-1.5 hover:bg-destructive/10 rounded-lg transition-all duration-150 opacity-0 group-hover:opacity-100",title:n("common.delete"),children:t.jsx(r,{className:"w-4 h-4 text-muted-foreground hover:text-destructive transition-colors",strokeWidth:2})})})]}),k&&t.jsx("div",{className:"pl-3 border-l-2 border-muted-foreground/20 mb-3",children:t.jsxs("p",{className:"text-sm text-foreground/60 line-clamp-1 leading-relaxed",children:[t.jsx("span",{className:"text-xs text-muted-foreground/50 font-medium mr-2 uppercase tracking-wide",children:"Original:"}),k.content||t.jsx("span",{className:"italic text-muted-foreground/40",children:"Empty memo"})]})}),C&&t.jsx("div",{onClick:async()=>{k&&(l(`/${k.name}`),d.status===g.UNREAD&&F(!0))},className:"p-2 sm:p-3 rounded-lg bg-gradient-to-br from-primary/[0.06] to-primary/[0.03] hover:from-primary/[0.1] hover:to-primary/[0.06] cursor-pointer border border-primary/30 hover:border-primary/50 transition-all duration-200 group/comment shadow-sm hover:shadow",children:t.jsxs("div",{className:"flex items-start gap-2",children:[t.jsx("div",{className:"w-5 h-5 flex items-center justify-center shrink-0",children:t.jsx(a,{className:"w-4 h-4 text-primary"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("p",{className:"text-xs text-primary/60 font-semibold mb-1 uppercase tracking-wider",children:"Comment"}),t.jsx("p",{className:"text-sm text-foreground/90 line-clamp-2",children:C.content||t.jsx("span",{className:"italic text-muted-foreground/50",children:"Empty comment"})})]})]})})]})]})]})}const D=()=>{const s=m(),r=k("sm"),[a,o]=e.useState("all"),{data:i=[]}=E(),c=U(i,e=>-((e.createTime?j(e.createTime):void 0)?.getTime()||0)),u=c.filter(e=>"unread"===a?e.status===g.UNREAD:"archived"!==a||e.status===g.ARCHIVED),x=c.filter(e=>e.status===g.UNREAD).length,h=c.filter(e=>e.status===g.ARCHIVED).length;return t.jsx("section",{className:"@container w-full max-w-[100rem] min-h-full flex flex-col justify-start items-center sm:pt-3 md:pt-6 pb-8",children:t.jsx("div",{className:"w-full px-4 sm:px-6",children:t.jsxs("div",{className:"w-full border border-border flex flex-col justify-start items-start rounded-xl bg-background text-foreground overflow-hidden",children:[r&&t.jsx("div",{className:"w-full px-4 py-4 border-b border-border",children:t.jsx("div",{className:"flex flex-row justify-between items-center",children:t.jsxs("div",{className:"flex flex-row items-center gap-2",children:[t.jsx(d,{className:"w-5 h-auto text-muted-foreground"}),t.jsx("h1",{className:"text-xl font-semibold",children:s("common.inbox")}),x>0&&t.jsx("span",{className:"ml-1 px-2 py-0.5 text-xs font-medium rounded-full bg-primary text-primary-foreground",children:x})]})})}),t.jsx("div",{className:"w-full px-4 py-2 border-b border-border bg-muted/30",children:t.jsxs("div",{className:"flex flex-row gap-1",children:[t.jsxs("button",{onClick:()=>o("all"),className:b("px-3 py-1.5 text-sm font-medium rounded-md transition-colors","all"===a?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground hover:bg-background/50"),children:[s("common.all")," (",c.length,")"]}),t.jsxs("button",{onClick:()=>o("unread"),className:b("px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center gap-1.5","unread"===a?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground hover:bg-background/50"),children:[t.jsx(n,{className:"w-3.5 h-auto"}),s("inbox.unread")," (",x,")"]}),t.jsxs("button",{onClick:()=>o("archived"),className:b("px-3 py-1.5 text-sm font-medium rounded-md transition-colors flex items-center gap-1.5","archived"===a?"bg-background text-foreground shadow-sm":"text-muted-foreground hover:text-foreground hover:bg-background/50"),children:[t.jsx(l,{className:"w-3.5 h-auto"}),s("common.archived")," (",h,")"]})]})}),t.jsx("div",{className:"w-full",children:0===u.length?t.jsxs("div",{className:"w-full py-16 flex flex-col justify-center items-center",children:[t.jsx(C,{}),t.jsx("p",{className:"mt-4 text-sm text-muted-foreground",children:s("unread"===a?"inbox.no-unread":"archived"===a?"inbox.no-archived":"message.no-data")})]}):t.jsx("div",{className:"flex flex-col",children:u.map(e=>e.type===T.MEMO_COMMENT?t.jsx(A,{notification:e},e.name):null)})})]})})})};export{D as default};
