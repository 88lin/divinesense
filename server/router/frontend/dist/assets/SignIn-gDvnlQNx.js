import{r as e,j as s,n as t,L as a,aB as o}from"./react-vendor-LyyF-653.js";import{A as r}from"./AuthFooter-DQfrcA-U.js";import{A as i}from"./AuthSkeleton-BwvtN304.js";import{P as l}from"./PasswordSignInForm-DSL2nr_-.js";import{i as n,e as c,u as m,aR as d,G as u,an as f,aJ as h,aS as p,aT as x,h as j}from"./index-D99LTaa7.js";import{S as w}from"./separator-Jvca_ZrM.js";import{a as g}from"./utils-B5ZcaJe4.js";import"./ui-vendor-ByoYm48K.js";import"./leaflet-vendor-Cu4zZue4.js";import"./markdown-vendor-DtAGkuPo.js";import"./math-vendor-JUchi9-2.js";import"./mermaid-vendor-B1M2OtO5.js";import"./lodash-vendor-DIRPa7cU.js";import"./ThemeSelect-Cq9CVVNd.js";import"./polyfills-RlNY0w59.js";import"./i18n-vendor-Cyfgqt0p.js";const v=()=>{const v=n(),{currentUser:y,isInitialized:N}=c(),[b,A]=e.useState([]),[P,S]=e.useState(!0),{generalSetting:k,isLoading:U}=m();if(e.useEffect(()=>{N&&y?.name&&(window.location.href=d.ROOT)},[N,y]),e.useEffect(()=>{(async()=>{try{const{identityProviders:e}=await f.listIdentityProviders({});A(e)}catch(e){}finally{S(!1)}})()},[]),U)return s.jsx(i,{});const C=P||b.length>0;return s.jsxs("div",{className:"py-4 sm:py-8 w-80 max-w-full min-h-svh mx-auto flex flex-col justify-start items-center",children:[s.jsxs("div",{className:"w-full py-4 grow flex flex-col justify-center items-center",children:[s.jsxs("div",{className:"w-full flex flex-row justify-center items-center mb-6",children:[s.jsx("img",{className:"h-14 w-auto rounded-full shadow",src:k.customProfile?.logoUrl||"/logo.webp",alt:""}),s.jsx("p",{className:"ml-2 text-5xl text-foreground opacity-80",children:k.customProfile?.title||v("app.name")})]}),k.disallowPasswordAuth?!P&&0===b.length&&s.jsx("p",{className:"w-full text-2xl mt-2 text-muted-foreground",children:v("auth.password-auth-not-allowed")}):s.jsx(l,{}),!k.disallowUserRegistration&&!k.disallowPasswordAuth&&s.jsxs("p",{className:"w-full mt-4 text-sm",children:[s.jsx("span",{className:"text-muted-foreground",children:v("auth.sign-up-tip")}),s.jsx(t,{to:"/auth/signup",className:"cursor-pointer ml-2 text-primary hover:underline",viewTransition:!0,children:v("common.sign-up")})]}),C&&s.jsxs("div",{className:"w-full min-h-[60px]",children:[!k.disallowPasswordAuth&&s.jsxs("div",{className:"relative my-4 w-full",children:[s.jsx(w,{}),s.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:s.jsx("span",{className:"bg-background px-2 text-xs text-muted-foreground",children:v("common.or")})})]}),s.jsx("div",{className:"w-full flex flex-col space-y-2",children:P?s.jsx("div",{className:"flex justify-center py-2",children:s.jsx(a,{className:"w-5 h-5 animate-spin text-muted-foreground"})}):b.map(e=>s.jsx(u,{className:"bg-background w-full",variant:"outline",onClick:()=>(async e=>{if(e.type===h.OAUTH2){const t=g("/auth/callback"),a="oauth2Config"===e.config?.config?.case?e.config.config.value:void 0;if(!a)return void o.error(v("auth.error.oauth-invalid"));try{const s=p(e.name),{state:o,codeChallenge:r}=await x(s),i=`${a.authUrl}?client_id=${a.clientId}&redirect_uri=${encodeURIComponent(t)}&state=${o}&response_type=code&scope=${encodeURIComponent(a.scopes.join(" "))}&code_challenge=${r}&code_challenge_method=S256`;window.location.href=i}catch(s){j(s,o.error,{context:v("auth.error.oauth-context"),fallbackMessage:v("auth.error.oauth-failed")})}}})(e),children:v("common.sign-in-with",{provider:e.title})},e.name))})]})]}),s.jsx(r,{})]})};export{v as default};
