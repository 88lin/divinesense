const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/react-vendor-LyyF-653.js","assets/ui-vendor-ByoYm48K.js","assets/leaflet-vendor-Cu4zZue4.js","assets/leaflet-vendor-Dyj9FDc_.css","assets/markdown-vendor-DtAGkuPo.js","assets/math-vendor-JUchi9-2.js","assets/math-vendor-DvXFAOB1.css","assets/mermaid-vendor-B1M2OtO5.js","assets/lodash-vendor-DIRPa7cU.js","assets/react-vendor-k-SYLBed.css"])))=>i.map(i=>d[i]);
import{_ as e}from"./mermaid-vendor-B1M2OtO5.js";import{u as s,r as t,j as a,bJ as r,C as n,R as l,co as i,cp as c,cq as d,b3 as o}from"./react-vendor-LyyF-653.js";import{d as m,bs as u,n as h,G as g,bt as x,bu as p,bv as f,bw as j,ay as b}from"./index-D99LTaa7.js";import"./lodash-vendor-DIRPa7cU.js";import"./leaflet-vendor-Cu4zZue4.js";import"./ui-vendor-ByoYm48K.js";import"./markdown-vendor-DtAGkuPo.js";import"./math-vendor-JUchi9-2.js";import"./polyfills-RlNY0w59.js";import"./i18n-vendor-Cyfgqt0p.js";const v=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#06b6d4","#84cc16","#f97316","#6366f1"],w={link:"#3b82f6",tag_co:"#10b981",semantic:"#8b5cf6"};function N(e,s,t,a){return{nodes:e.map(e=>({id:e.id,label:e.label,type:e.type,tags:e.tags,importance:e.importance,cluster:e.cluster,createdTs:e.createdTs})),edges:s.map(e=>({source:e.source,target:e.target,type:e.type,weight:e.weight})),stats:t,buildMs:a}}const k=t.lazy(()=>e(()=>import("./react-vendor-LyyF-653.js").then(e=>e.cr),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))),y=({className:e})=>{const{t:y}=s(),C=m(),z=t.useRef(null),S=t.useRef(void 0),[_,M]=t.useState({width:0,height:0}),[R,T]=t.useState(0),[$,E]=t.useState([]),[I,D]=t.useState({link:!0,tag_co:!0,semantic:!0}),{data:P,isLoading:L,isError:O,refetch:W}=u({tags:[],minImportance:R,clusters:$}),A=t.useMemo(()=>P?N(P.nodes,P.edges,P.stats??null,P.buildMs):null,[P]),F=t.useMemo(()=>{if(!A)return{nodes:[],links:[]};const e=A.edges.filter(e=>!1!==I[e.type]),s=new Set;e.forEach(e=>{s.add(e.source),s.add(e.target)});return{nodes:(s.size>0?A.nodes.filter(e=>s.has(e.id)):A.nodes).map(e=>({id:e.id,label:e.label,type:e.type,tags:e.tags,importance:e.importance,cluster:e.cluster,createdTs:e.createdTs})),links:e.map(e=>({source:e.source,target:e.target,type:e.type,weight:e.weight}))}},[A,I]),V=t.useMemo(()=>{if(!A)return[];const e=new Set;return A.nodes.forEach(s=>e.add(s.cluster)),Array.from(e).sort((e,s)=>e-s)},[A]);t.useEffect(()=>{if(!z.current)return;const e=()=>{if(z.current){const e=z.current.getBoundingClientRect();M({width:e.width,height:e.height})}};e();const s=new ResizeObserver(e);return s.observe(z.current),()=>s.disconnect()},[]);const q=t.useCallback((e,s)=>{const t=e;t.id.startsWith("memos/")&&C(`/${t.id}`)},[C]),B=t.useCallback(e=>v[e.cluster%v.length],[]),G=t.useCallback(e=>4+12*e.importance,[]),J=t.useCallback(e=>w[e.type]||"#94a3b8",[]),Z=t.useCallback(e=>.5+2*e.weight,[]);return L?a.jsx("div",{className:h("flex items-center justify-center h-full",e),children:a.jsx(r,{className:"w-8 h-8 animate-spin text-muted-foreground"})}):O?a.jsxs("div",{className:h("flex flex-col items-center justify-center h-full gap-3",e),children:[a.jsx(n,{className:"w-8 h-8 text-destructive"}),a.jsx("p",{className:"text-muted-foreground",children:y("ai.knowledge-graph.load-error")}),a.jsxs(g,{variant:"outline",size:"sm",onClick:()=>W(),children:[a.jsx(l,{className:"w-4 h-4 mr-1"}),y("common.retry")]})]}):a.jsxs("div",{className:h("flex flex-col h-full",e),children:[a.jsxs("div",{className:"flex items-center justify-between p-2 border-b",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs(x,{children:[a.jsx(p,{asChild:!0,children:a.jsxs(g,{variant:"outline",size:"sm",children:[a.jsx(i,{className:"w-4 h-4 mr-1"}),y("ai.knowledge-graph.filter")]})}),a.jsx(f,{className:"w-80",children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:y("ai.knowledge-graph.min-importance")}),a.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[a.jsx("input",{type:"range",min:"0",max:"100",step:"5",value:100*R,onChange:e=>{T(Number(e.target.value)/100)},className:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700"}),a.jsxs("span",{className:"text-sm text-muted-foreground w-10",children:[Math.round(100*R),"%"]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:y("ai.knowledge-graph.edge-types")}),a.jsx("div",{className:"flex flex-col gap-2 mt-2",children:Object.entries(w).map(([e,s])=>a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(j,{id:`edge-${e}`,checked:I[e],onCheckedChange:()=>(e=>{D(s=>({...s,[e]:!s[e]}))})(e)}),a.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:s}}),a.jsx("label",{htmlFor:`edge-${e}`,className:"text-sm",children:y(`ai.knowledge-graph.edge-type-${e}`)})]},e))})]}),V.length>0&&a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:y("ai.knowledge-graph.clusters")}),a.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:V.map(e=>a.jsx(b,{variant:0===$.length||$.includes(e)?"default":"outline",className:"cursor-pointer",style:{backgroundColor:0===$.length||$.includes(e)?v[e%v.length]:void 0},onClick:()=>(e=>{E(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e])})(e),children:e+1},e))})]})]})})]}),a.jsx(g,{variant:"outline",size:"sm",onClick:()=>W(),children:a.jsx(l,{className:"w-4 h-4"})})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx(g,{variant:"ghost",size:"icon",onClick:()=>{S.current&&S.current.zoom(S.current.zoom()/1.5,300)},children:a.jsx(c,{className:"w-4 h-4"})}),a.jsx(g,{variant:"ghost",size:"icon",onClick:()=>{S.current&&S.current.zoom(1.5*S.current.zoom(),300)},children:a.jsx(d,{className:"w-4 h-4"})}),a.jsx(g,{variant:"ghost",size:"icon",onClick:()=>{S.current&&S.current.zoomToFit(400,50)},children:a.jsx(o,{className:"w-4 h-4"})})]})]}),a.jsx("div",{ref:z,className:"flex-1 relative",children:F.nodes.length>0?a.jsx(t.Suspense,{fallback:a.jsx("div",{className:"flex items-center justify-center h-full",children:a.jsx(r,{className:"w-8 h-8 animate-spin text-muted-foreground"})}),children:a.jsx(k,{ref:S,width:_.width,height:_.height,graphData:F,nodeId:"id",nodeLabel:e=>{const s=e;return`${s.label}\n${s.tags.map(e=>`#${e}`).join(" ")}`},nodeColor:B,nodeRelSize:1,nodeVal:G,linkColor:J,linkWidth:Z,linkDirectionalParticles:1,linkDirectionalParticleWidth:e=>2*e.weight,onNodeClick:q,cooldownTicks:100,enableZoomInteraction:!0,enablePanInteraction:!0})}):a.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:a.jsx("p",{className:"text-muted-foreground",children:y("ai.knowledge-graph.no-data")})})}),A?.stats&&a.jsxs("div",{className:"flex items-center justify-between p-2 border-t text-xs text-muted-foreground",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("span",{children:[y("ai.knowledge-graph.nodes"),": ",A.stats.nodeCount]}),a.jsxs("span",{children:[y("ai.knowledge-graph.edges"),": ",A.stats.edgeCount]}),a.jsxs("span",{children:[y("ai.knowledge-graph.clusters-count"),": ",A.stats.clusterCount]})]}),a.jsxs("span",{children:[y("ai.knowledge-graph.build-time"),": ",Number(A.buildMs),"ms"]})]})]})};export{v as CLUSTER_COLORS,w as EDGE_TYPE_COLORS,N as convertProtoToGraphData,y as default};
