const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-C8xbpMxv.js","assets/react-vendor-LyyF-653.js","assets/ui-vendor-ByoYm48K.js","assets/leaflet-vendor-Cu4zZue4.js","assets/leaflet-vendor-Dyj9FDc_.css","assets/markdown-vendor-DtAGkuPo.js","assets/math-vendor-JUchi9-2.js","assets/math-vendor-DvXFAOB1.css","assets/mermaid-vendor-B1M2OtO5.js","assets/lodash-vendor-DIRPa7cU.js","assets/react-vendor-k-SYLBed.css","assets/index-D99LTaa7.js","assets/polyfills-RlNY0w59.js","assets/i18n-vendor-Cyfgqt0p.js","assets/index-RrxYxfV3.css"])))=>i.map(i=>d[i]);
import{j as e,r as s,aT as a,bn as t,by as l,aK as r,u as m,L as n,a4 as o,n as i,F as c,bz as d,ac as x,aB as f,bA as u,bw as h}from"./react-vendor-LyyF-653.js";import{_ as p}from"./mermaid-vendor-B1M2OtO5.js";import{i as j,q as w,y as N,z as g,n as v,t as y,A as b,R as k,r as T,d as C,a as L,B as $,C as P,M as E,D as R,G as _,H as F}from"./index-D99LTaa7.js";import{a2 as S}from"./lodash-vendor-DIRPa7cU.js";import"./ui-vendor-ByoYm48K.js";import"./leaflet-vendor-Cu4zZue4.js";import"./markdown-vendor-DtAGkuPo.js";import"./math-vendor-JUchi9-2.js";import"./polyfills-RlNY0w59.js";import"./i18n-vendor-Cyfgqt0p.js";const z=s.lazy(()=>p(()=>import("./index-C8xbpMxv.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]))),A=({memo:m,className:n,parentPage:o})=>{const i=j(),c=w(N,m.property||{}),d=c.hasLink||c.hasTaskList||c.hasCode||c.hasIncompleteTasks,x=m.relations.filter(e=>e.type===g.REFERENCE).length>0;return e.jsx("aside",{className:v("relative w-full h-auto max-h-screen overflow-auto hide-scrollbar flex flex-col justify-start items-start",n),children:e.jsxs("div",{className:"flex flex-col justify-start items-start w-full px-1 gap-2 h-auto shrink-0 flex-nowrap hide-scrollbar",children:[x&&e.jsxs("div",{className:"relative w-full h-36 border border-border rounded-lg bg-muted",children:[e.jsx(s.Suspense,{fallback:e.jsx("div",{className:"w-full h-full flex items-center justify-center text-xs opacity-60",children:"Loading..."}),children:e.jsx(z,{className:"w-full h-full",memo:m,parentPage:o})}),e.jsxs("div",{className:"absolute top-1 left-2 text-xs opacity-60 font-mono gap-1 flex flex-row items-center",children:[e.jsx("span",{children:i("common.relations")}),e.jsx("span",{className:"text-xs opacity-60",children:"(Beta)"})]})]}),e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("p",{className:"flex flex-row justify-start items-center w-full gap-1 mb-1 text-sm leading-6 text-muted-foreground select-none",children:e.jsx("span",{children:i("common.created-at")})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:m.createTime&&y(m.createTime).toLocaleString()})]}),!S(m.createTime,m.updateTime)&&e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("p",{className:"flex flex-row justify-start items-center w-full gap-1 mb-1 text-sm leading-6 text-muted-foreground select-none",children:e.jsx("span",{children:i("common.last-updated-at")})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:m.updateTime&&y(m.updateTime).toLocaleString()})]}),d&&e.jsxs("div",{className:"w-full flex flex-col",children:[e.jsx("p",{className:"flex flex-row justify-start items-center w-full gap-1 mb-1 text-sm leading-6 text-muted-foreground select-none",children:e.jsx("span",{children:i("common.properties")})}),e.jsxs("div",{className:"w-full flex flex-row justify-start items-center gap-x-2 gap-y-1 flex-wrap text-muted-foreground",children:[c.hasLink&&e.jsx("div",{className:"w-auto border border-border pl-1 pr-1.5 rounded-md flex justify-between items-center",children:e.jsxs("div",{className:"w-auto flex justify-start items-center mr-1",children:[e.jsx(a,{className:"w-4 h-auto mr-1"}),e.jsx("span",{className:"block text-sm",children:i("memo.links")})]})}),c.hasTaskList&&e.jsx("div",{className:"w-auto border border-border pl-1 pr-1.5 rounded-md flex justify-between items-center",children:e.jsxs("div",{className:"w-auto flex justify-start items-center mr-1",children:[e.jsx(t,{className:"w-4 h-auto mr-1"}),e.jsx("span",{className:"block text-sm",children:i("memo.to-do")})]})}),c.hasCode&&e.jsx("div",{className:"w-auto border border-border pl-1 pr-1.5 rounded-md flex justify-between items-center",children:e.jsxs("div",{className:"w-auto flex justify-start items-center mr-1",children:[e.jsx(l,{className:"w-4 h-auto mr-1"}),e.jsx("span",{className:"block text-sm",children:i("memo.code")})]})})]})]}),m.tags.length>0&&e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex flex-row justify-start items-center w-full gap-1 mb-1 text-sm leading-6 text-muted-foreground select-none",children:[e.jsx("span",{children:i("common.tags")}),e.jsxs("span",{className:"shrink-0",children:["(",m.tags.length,")"]})]}),e.jsx("div",{className:"w-full flex flex-row justify-start items-center relative flex-wrap gap-x-2 gap-y-1",children:m.tags.map(s=>e.jsxs("div",{className:"shrink-0 w-auto max-w-full text-sm rounded-md leading-6 flex flex-row justify-start items-center select-none hover:opacity-80 text-muted-foreground",children:[e.jsx(r,{className:"group-hover:hidden w-4 h-auto shrink-0 opacity-40"}),e.jsx("div",{className:v("inline-flex flex-nowrap ml-0.5 gap-0.5 cursor-pointer max-w-[calc(100%-16px)]"),children:e.jsx("span",{className:"truncate opacity-80",children:s})})]},s))})]})]})})},B=({memoName:s,className:a})=>{const{t:t}=m(),{data:l,isLoading:r}=b(s);return r?e.jsx("div",{className:v("w-full p-4 flex justify-center",a),children:e.jsx(n,{className:"w-4 h-4 animate-spin text-muted-foreground"})}):l?.memos&&0!==l.memos.length?e.jsxs("div",{className:v("w-full space-y-2 mt-4",a),children:[e.jsxs("h3",{className:"text-sm font-medium text-muted-foreground flex items-center gap-1",children:[e.jsx(o,{className:"w-3 h-3"}),t("common.related-memos")||"Related Memos"]}),e.jsx("div",{className:"flex flex-col gap-2",children:l.memos.map(s=>{const a=s.name.split("/").pop();return e.jsxs(i,{to:`/m/${a}`,className:k,children:[e.jsx("div",{className:"flex items-center justify-between mb-1",children:e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(c,{className:"w-3 h-3 text-muted-foreground"}),e.jsxs("span",{children:["Relevance: ",(100*s.score).toFixed(0),"%"]})]})}),e.jsx("p",{className:"text-sm text-foreground line-clamp-2 leading-relaxed group-hover:text-blue-600 dark:group-hover:text-blue-400",children:s.snippet})]},s.name)})})]}):null},D=()=>{const a=j(),t=T("md"),l=d(),r=C(),{state:m}=x(),n=L(),o=l.uid,c=`${R}${o}`,[p,w]=s.useState(!1),{data:N,error:g,isLoading:y}=$(c,{enabled:!!c});g&&(f.error(g.message),r("/403"));const{data:b}=$(N?.parent||"",{enabled:!!N?.parent}),{data:k}=P(c,{enabled:!!N}),S=k?.memos||[],z=n&&!p;if(y||!N)return null;const D=()=>{w(!0)};return e.jsx("section",{className:"@container w-full max-w-[100rem] min-h-full flex flex-col justify-start items-center sm:pt-3 md:pt-6 pb-8",children:e.jsxs("div",{className:v("w-full flex flex-row justify-start items-start px-4 sm:px-6 gap-4"),children:[e.jsxs("div",{className:v("w-full md:w-[calc(100%-15rem)]"),children:[b&&e.jsx("div",{className:"w-auto inline-block mb-2",children:e.jsxs(i,{className:"px-3 py-1 border border-border rounded-lg max-w-xs w-auto text-sm flex flex-row justify-start items-center flex-nowrap text-muted-foreground hover:shadow hover:opacity-80",to:`/${b.name}`,state:m,viewTransition:!0,children:[e.jsx(u,{className:"w-4 h-auto shrink-0 opacity-60 mr-2"}),e.jsx("span",{className:"truncate",children:b.content})]})}),e.jsx(E,{className:"shadow hover:shadow-md transition-all",memo:N,compact:!1,parentPage:m?.from,showCreator:!0,showVisibility:!0,showPinned:!0,showNsfwContent:!0},`${N.name}-${N.displayTime}`),e.jsx(B,{memoName:c}),e.jsxs("div",{className:"pt-8 pb-16 w-full",children:[e.jsx("h2",{id:"comments",className:"sr-only",children:a("memo.comment.self")}),e.jsx("div",{className:"relative mx-auto grow w-full min-h-full flex flex-col justify-start items-start gap-y-1",children:0===S.length?z&&e.jsx("div",{className:"w-full flex flex-row justify-center items-center py-6",children:e.jsxs(_,{variant:"ghost",onClick:D,children:[e.jsx("span",{className:"text-muted-foreground",children:a("memo.comment.write-a-comment")}),e.jsx(h,{className:"ml-2 w-5 h-auto text-muted-foreground"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full flex flex-row justify-between items-center h-8 pl-3 mb-2",children:[e.jsxs("div",{className:"flex flex-row justify-start items-center",children:[e.jsx(h,{className:"w-5 h-auto text-muted-foreground mr-1"}),e.jsx("span",{className:"text-muted-foreground text-sm",children:a("memo.comment.self")}),e.jsxs("span",{className:"text-muted-foreground text-sm ml-1",children:["(",S.length,")"]})]}),z&&e.jsx(_,{variant:"ghost",className:"text-muted-foreground",onClick:D,children:a("memo.comment.write-a-comment")})]}),S.map(s=>e.jsx(E,{memo:s,parentPage:m?.from,showCreator:!0,compact:!0},`${s.name}-${s.displayTime}`))]})}),p&&e.jsx("div",{className:"w-full",children:e.jsx(F,{cacheKey:`${N.name}-${N.updateTime}-comment`,placeholder:a("editor.add-your-comment-here"),parentMemoName:N.name,autoFocus:!0,onConfirm:async e=>{w(!1)},onCancel:()=>w(!1)})})]})]}),t&&e.jsx("div",{className:"sticky top-0 left-0 shrink-0 -mt-6 w-56 h-full",children:e.jsx(A,{className:"py-6",memo:N,parentPage:m?.from})})]})})};export{D as default};
