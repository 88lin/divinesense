import{d as e,r,j as a}from"./react-vendor-LyyF-653.js";import{d as s,e as t,v as o,f as i,s as n,t as d,h as c,g as l}from"./index-D99LTaa7.js";import{a as m}from"./utils-B5ZcaJe4.js";import"./ui-vendor-ByoYm48K.js";import"./leaflet-vendor-Cu4zZue4.js";import"./markdown-vendor-DtAGkuPo.js";import"./math-vendor-JUchi9-2.js";import"./mermaid-vendor-B1M2OtO5.js";import"./lodash-vendor-DIRPa7cU.js";import"./polyfills-RlNY0w59.js";import"./i18n-vendor-Cyfgqt0p.js";const p=()=>{const p=s(),{initialize:g}=t(),[f]=e(),[u,v]=r.useState({loading:!0,errorMessage:""});return r.useEffect(()=>{const e=f.get("error"),r=f.get("error_description"),a=f.get("error_uri");if(e){let s=`OAuth error: ${e}`;return r&&(s+=`\n${decodeURIComponent(r)}`),a&&(s+=`\nMore info: ${a}`),void v({loading:!1,errorMessage:s})}const s=f.get("code"),t=f.get("state");if(!s||!t)return void v({loading:!1,errorMessage:"Failed to authorize. Missing authorization code or state parameter."});const l=o(t);if(!l)return void v({loading:!1,errorMessage:"Failed to authorize. Invalid or expired state parameter. This may indicate a CSRF attack attempt."});const{identityProviderId:u,returnUrl:h,codeVerifier:j}=l,x=m("/auth/callback");(async()=>{try{const e=await i.signIn({credentials:{case:"ssoCredentials",value:{idpId:u,code:s,redirectUri:x,codeVerifier:j||""}}});e.accessToken&&n(e.accessToken,e.accessTokenExpiresAt?d(e.accessTokenExpiresAt):void 0),v({loading:!1,errorMessage:""}),await g(),p(h||"/")}catch(e){c(e,()=>{},{fallbackMessage:"Failed to authenticate.",onError:e=>{const r=e instanceof Error?e.message:"Failed to authenticate.";v({loading:!1,errorMessage:r})}})}})()},[f,p]),a.jsx("div",{className:"p-4 py-24 w-full h-full flex justify-center items-center",children:u.loading?a.jsx(l,{size:"lg"}):a.jsx("div",{className:"max-w-[32rem] font-mono whitespace-pre-wrap opacity-80",children:u.errorMessage})})};export{p as default};
