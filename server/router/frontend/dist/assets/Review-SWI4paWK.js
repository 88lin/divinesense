import{b as e,r as s,a,c as r,j as l,R as t,C as d,ca as i,a6 as c,cd as n,a4 as o,cj as m,p as x,n as u,N as h}from"./react-vendor-LyyF-653.js";import{i as j,r as v,be as g,bf as p,G as w,n as b}from"./index-D99LTaa7.js";import"./ui-vendor-ByoYm48K.js";import"./leaflet-vendor-Cu4zZue4.js";import"./markdown-vendor-DtAGkuPo.js";import"./math-vendor-JUchi9-2.js";import"./mermaid-vendor-B1M2OtO5.js";import"./lodash-vendor-DIRPa7cU.js";import"./polyfills-RlNY0w59.js";import"./i18n-vendor-Cyfgqt0p.js";const N=()=>{const N=j(),f=v("sm"),y=e(),[q,R]=s.useState(0),[k,C]=s.useState(!1),{data:S,isLoading:U,isError:A,refetch:D}=a({queryKey:["reviews","due"],queryFn:async()=>await g.getDueReviews({limit:20})}),{data:E,isLoading:F,isError:G,refetch:K}=a({queryKey:["reviews","stats"],queryFn:async()=>await g.getReviewStats({})}),L=r({mutationFn:async({memoUid:e,quality:s})=>{await g.recordReview({memoUid:e,quality:s})},onSuccess:()=>{y.invalidateQueries({queryKey:["reviews"]}),C(!1),S&&q<S.items.length-1&&R(e=>e+1)}}),M=S?.items[q],O=S?.totalDue||0,T=O>0?(q+1)/O*100:0,$=[{quality:p.AGAIN,label:N("review.quality.again"),color:"bg-red-500 hover:bg-red-600",desc:N("review.quality.again-desc")},{quality:p.HARD,label:N("review.quality.hard"),color:"bg-orange-500 hover:bg-orange-600",desc:N("review.quality.hard-desc")},{quality:p.GOOD,label:N("review.quality.good"),color:"bg-green-500 hover:bg-green-600",desc:N("review.quality.good-desc")},{quality:p.EASY,label:N("review.quality.easy"),color:"bg-blue-500 hover:bg-blue-600",desc:N("review.quality.easy-desc")}];return U||F?l.jsx("div",{className:"w-full h-full flex items-center justify-center",children:l.jsx(t,{className:"w-8 h-8 animate-spin text-muted-foreground"})}):A||G?l.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center gap-4",children:[l.jsx(d,{className:"w-12 h-12 text-destructive"}),l.jsx("p",{className:"text-muted-foreground",children:N("review.load-error")}),l.jsx(w,{onClick:()=>{D(),K()},children:N("common.retry")||"Retry"})]}):l.jsxs("div",{className:"w-full max-w-[100rem] mx-auto px-4 py-6 space-y-6",children:[f&&l.jsx("div",{className:"flex items-center justify-between",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:l.jsx(i,{className:"w-6 h-6 text-primary"})}),l.jsxs("div",{children:[l.jsx("h1",{className:"text-2xl font-bold",children:N("review.title")}),l.jsx("p",{className:"text-sm text-muted-foreground",children:N("review.subtitle")})]})]})}),l.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[l.jsxs("div",{className:"p-4 rounded-lg border border-border bg-card",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(c,{className:"w-4 h-4 text-orange-500"}),l.jsx("span",{className:"text-sm text-muted-foreground",children:N("review.stats.due-today")})]}),l.jsx("p",{className:"text-2xl font-bold mt-1",children:E?.dueToday||0})]}),l.jsxs("div",{className:"p-4 rounded-lg border border-border bg-card",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(n,{className:"w-4 h-4 text-green-500"}),l.jsx("span",{className:"text-sm text-muted-foreground",children:N("review.stats.reviewed-today")})]}),l.jsx("p",{className:"text-2xl font-bold mt-1",children:E?.reviewedToday||0})]}),l.jsxs("div",{className:"p-4 rounded-lg border border-border bg-card",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(o,{className:"w-4 h-4 text-blue-500"}),l.jsx("span",{className:"text-sm text-muted-foreground",children:N("review.stats.new-memos")})]}),l.jsx("p",{className:"text-2xl font-bold mt-1",children:E?.newMemos||0})]}),l.jsxs("div",{className:"p-4 rounded-lg border border-border bg-card",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(m,{className:"w-4 h-4 text-yellow-500"}),l.jsx("span",{className:"text-sm text-muted-foreground",children:N("review.stats.mastered")})]}),l.jsx("p",{className:"text-2xl font-bold mt-1",children:E?.masteredMemos||0})]})]}),M?l.jsxs("div",{className:"rounded-lg border border-border bg-card overflow-hidden",children:[l.jsxs("div",{className:"p-4 border-b border-border",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("h3",{className:"text-lg font-semibold",children:M.title||N("review.untitled")}),l.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[l.jsx(x,{className:"w-4 h-4"}),l.jsx("span",{children:N("review.review-count",{count:M.reviewCount})})]})]}),l.jsx("div",{className:"flex items-center gap-2 mt-2",children:M.tags?.map(e=>l.jsxs("span",{className:"px-2 py-0.5 bg-muted rounded-full text-xs",children:["#",e]},e))})]}),l.jsxs("div",{className:"p-4 space-y-4",children:[l.jsxs("div",{className:"space-y-1",children:[l.jsxs("div",{className:"flex items-center justify-between text-sm",children:[l.jsx("span",{className:"text-muted-foreground",children:N("review.progress")}),l.jsxs("span",{className:"font-medium",children:[q+1," / ",O]})]}),l.jsx("div",{className:"w-full h-2 bg-muted rounded-full overflow-hidden",children:l.jsx("div",{className:"h-full bg-primary transition-all duration-300",style:{width:`${T}%`}})})]}),l.jsx("div",{className:b("p-4 bg-muted/50 rounded-lg min-h-[120px] transition-all",!k&&"blur-sm select-none"),children:l.jsx("p",{className:"text-sm whitespace-pre-wrap",children:M.snippet})}),k?l.jsxs("div",{className:"space-y-3",children:[l.jsx("p",{className:"text-sm text-center text-muted-foreground",children:N("review.how-well")}),l.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:$.map(({quality:e,label:s,color:a,desc:r})=>l.jsxs(w,{variant:"outline",className:b("flex-col h-auto py-3 gap-1 text-white border-0",a),onClick:()=>(e=>{M&&L.mutate({memoUid:M.memoUid,quality:e})})(e),disabled:L.isPending,children:[l.jsx("span",{className:"font-medium",children:s}),l.jsx("span",{className:"text-xs opacity-80",children:r})]},e))}),l.jsx(u,{to:`/memos/${M.memoUid}`,className:"block",children:l.jsxs(w,{variant:"ghost",className:"w-full gap-2",children:[N("review.view-memo"),l.jsx(h,{className:"w-4 h-4"})]})})]}):l.jsx(w,{className:"w-full",size:"lg",onClick:()=>C(!0),children:N("review.show-answer")})]})]}):l.jsxs("div",{className:"rounded-lg border border-border bg-card p-12 text-center",children:[l.jsx(m,{className:"w-12 h-12 mx-auto text-yellow-500 mb-4"}),l.jsx("h3",{className:"text-xl font-semibold mb-2",children:N("review.all-done")}),l.jsx("p",{className:"text-muted-foreground",children:N("review.all-done-desc")})]})]})};export{N as default};
