import{j as e,C as s,r as t,L as a,n as r}from"./react-vendor-LyyF-653.js";import{n as l,i,Q as n,u as o,T as m,G as c,q as d,aq as u,ar as f,p as x,f as p,s as h,t as j}from"./index-D99LTaa7.js";import{A as g}from"./AuthFooter-DQfrcA-U.js";import{A as w}from"./AuthSkeleton-BwvtN304.js";import"./ui-vendor-ByoYm48K.js";import"./leaflet-vendor-Cu4zZue4.js";import"./markdown-vendor-DtAGkuPo.js";import"./math-vendor-JUchi9-2.js";import"./mermaid-vendor-B1M2OtO5.js";import"./lodash-vendor-DIRPa7cU.js";import"./polyfills-RlNY0w59.js";import"./i18n-vendor-Cyfgqt0p.js";import"./ThemeSelect-Cq9CVVNd.js";function v({message:t,className:a}){return e.jsxs("div",{className:l("mb-4 flex items-start gap-3 p-4 text-sm text-destructive bg-destructive/5 border border-destructive/20 rounded-lg animate-in fade-in slide-in-from-top-2",a),children:[e.jsx(s,{className:"w-5 h-5 shrink-0 mt-0.5"}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"font-medium",children:t})})]})}const N=()=>{const s=i(),l=n(!1),[N,y]=t.useState(""),[b,k]=t.useState(""),[C,L]=t.useState(""),{generalSetting:S,profile:T,isLoading:A}=o();if(A)return e.jsx(w,{});const F=async()=>{if(""!==N.trim()&&""!==b.trim()){if(!l.isLoading){try{l.setLoading();const e=d(u,{username:N.trim(),password:b,role:f.USER});await x.createUser({user:e});const s=await p.signIn({credentials:{case:"passwordCredentials",value:{username:N.trim(),password:b}}});s.accessToken&&h(s.accessToken,s.accessTokenExpiresAt?j(s.accessTokenExpiresAt):void 0),window.location.href="/"}catch(e){const t=e instanceof Error?e.message:String(e);L(function(e,s,t){const a=e.toLowerCase();return a.includes("invalid username")?s.includes("@")?t("auth.error.username-email-format"):t("auth.error.username-format"):a.includes("already exists")||a.includes("duplicate")||a.includes("conflict")?t("auth.error.username-exists"):a.includes("network")||a.includes("fetch")||a.includes("connect")?t("auth.error.network"):a.includes("invalid")||a.includes("validation")||a.includes("format")?t("auth.error.invalid-input"):a.includes("500")||a.includes("502")||a.includes("503")?t("auth.error.server"):a.includes("429")||a.includes("rate limit")||a.includes("too many")?t("auth.error.rate-limit",{count:"5"}):t("auth.error.sign-up-failed")}(t,N.trim(),s))}l.setFinish()}}else L(s("auth.error.empty-fields"))};return e.jsxs("div",{className:"py-4 sm:py-8 w-80 max-w-full min-h-svh mx-auto flex flex-col justify-start items-center",children:[e.jsxs("div",{className:"w-full py-4 grow flex flex-col justify-center items-center",children:[e.jsxs("div",{className:"w-full flex flex-row justify-center items-center mb-6",children:[e.jsx("img",{className:"h-14 w-auto rounded-full shadow",src:S.customProfile?.logoUrl||"/logo.webp",alt:""}),e.jsx("p",{className:"ml-2 text-5xl text-foreground opacity-80",children:S.customProfile?.title||s("app.name")})]}),S.disallowUserRegistration?e.jsx("p",{className:"w-full text-center text-lg text-muted-foreground px-4 py-6 bg-muted/30 rounded-lg",children:s("auth.sign-up-not-allowed")}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"w-full text-2xl text-muted-foreground",children:s("auth.create-your-account")}),e.jsxs("form",{className:"w-full mt-4",onSubmit:e=>{e.preventDefault(),F()},children:[C&&e.jsx(v,{message:C}),e.jsxs("div",{className:"flex flex-col justify-start items-start w-full gap-4",children:[e.jsxs("div",{className:"w-full flex flex-col justify-start items-start",children:[e.jsx("label",{htmlFor:"username",className:"leading-8 text-muted-foreground text-sm font-medium",children:s("common.username")}),e.jsx(m,{id:"username",className:"w-full bg-background h-11",type:"text",readOnly:l.isLoading,placeholder:s("common.username"),value:N,autoComplete:"username",autoCapitalize:"off",spellCheck:!1,onChange:e=>{const s=e.target.value;y(s),C&&L("")},required:!0})]}),e.jsxs("div",{className:"w-full flex flex-col justify-start items-start",children:[e.jsx("label",{htmlFor:"password",className:"leading-8 text-muted-foreground text-sm font-medium",children:s("common.password")}),e.jsx(m,{id:"password",className:"w-full bg-background h-11",type:"password",readOnly:l.isLoading,placeholder:s("common.password"),value:b,autoComplete:"new-password",autoCapitalize:"off",spellCheck:!1,onChange:e=>{const s=e.target.value;k(s),C&&L("")},required:!0})]})]}),e.jsx("div",{className:"flex flex-row justify-end items-center w-full mt-6",children:e.jsx(c,{type:"submit",className:"w-full h-11",disabled:l.isLoading,onClick:F,children:l.isLoading?e.jsxs(e.Fragment,{children:[e.jsx(a,{className:"w-5 h-5 animate-spin opacity-60"}),e.jsx("span",{className:"ml-2",children:s("common.loading")})]}):s("common.sign-up")})})]})]}),e.jsx("div",{className:"h-7 mt-4",children:T.owner?e.jsxs("p",{className:"w-full text-sm text-center",children:[e.jsx("span",{className:"text-muted-foreground",children:s("auth.sign-in-tip")}),e.jsx(r,{to:"/auth",className:"cursor-pointer ml-1 text-primary hover:underline font-medium",viewTransition:!0,children:s("common.sign-in")})]}):e.jsx("p",{className:"w-full text-sm text-center text-muted-foreground",children:s("auth.host-tip")})})]}),e.jsx(g,{})]})};export{N as default};
